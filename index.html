<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Murugan Super Store - Complete E-Commerce</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        amazon: {
                            dark: '#131921',
                            light: '#232f3e',
                            yellow: '#febd69',
                            orange: '#cd9042',
                            blue: '#007185'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out'
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Custom styles */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .text-input-style {
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            border-radius: 0.25rem;
            outline: none;
            transition: all 150ms ease-in-out;
        }

        .text-input-style:focus {
            box-shadow: 0 0 0 2px rgba(254, 189, 105, 0.5);
            border-color: #febd69;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cd9042;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #febd69;
        }

        /* Print Styles */
        @media print {
            body > :not(.print-bill) {
                display: none !important;
            }
            .print-bill {
                display: block !important;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                color: #000;
            }
            .print-bill * {
                box-shadow: none !important;
                border: none !important;
            }
        }

        /* Mobile Navigation Padding */
        .pb-mobile-nav {
            padding-bottom: 70px;
        }

        /* Product Card Hover Effects */
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Badge Animation */
        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .badge-pulse {
            animation: badge-pulse 1s infinite;
        }

        /* Loading Animation */
        .loader-dots {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
        }

        .loader-dots div {
            position: absolute;
            top: 33px;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: #febd69;
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .loader-dots div:nth-child(1) {
            left: 8px;
            animation: loader-dots1 0.6s infinite;
        }

        .loader-dots div:nth-child(2) {
            left: 8px;
            animation: loader-dots2 0.6s infinite;
        }

        .loader-dots div:nth-child(3) {
            left: 32px;
            animation: loader-dots2 0.6s infinite;
        }

        .loader-dots div:nth-child(4) {
            left: 56px;
            animation: loader-dots3 0.6s infinite;
        }

        @keyframes loader-dots1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes loader-dots3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }

        @keyframes loader-dots2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }

        /* Shimmer Effect for Loading */
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Discount Badge */
        .discount-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Offer Banner */
        .offer-banner {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            animation: gradient 3s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // ==========================================
        //  CONFIGURATION
        // ==========================================
        const API_URL = "https://script.google.com/macros/s/AKfycby_LIjEUekeXDKS_yXbykzfHtfAuaMQ8rpdpmDOhR4kTpOiBLhgknTlcFUhJk9Xyx0j/exec";

        // ==========================================
        //  UTILITIES AND COMPONENTS
        // ==========================================

        // --- LOADER COMPONENT ---
        const Loader = () => (
            <div className="flex flex-col justify-center items-center p-10">
                <div className="loader-dots">
                    <div></div><div></div><div></div><div></div>
                </div>
                <span className="mt-3 text-gray-600 animate-pulse">Loading...</span>
            </div>
        );

        // --- SHIMMER LOADER ---
        const ShimmerLoader = ({ count = 6 }) => (
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                {Array.from({ length: count }).map((_, idx) => (
                    <div key={idx} className="bg-white rounded-lg p-4 shadow">
                        <div className="shimmer h-32 w-full mb-3 rounded"></div>
                        <div className="shimmer h-4 w-3/4 mb-2 rounded"></div>
                        <div className="shimmer h-4 w-1/2 mb-3 rounded"></div>
                        <div className="shimmer h-8 w-full rounded"></div>
                    </div>
                ))}
            </div>
        );

        // --- STATUS COLOR UTILITY ---
        const getStatusColor = (status) => {
            const colors = {
                'Pending': 'bg-yellow-100 text-yellow-800',
                'Confirmed': 'bg-blue-100 text-blue-800',
                'Shipped': 'bg-indigo-100 text-indigo-800',
                'Delivered': 'bg-green-100 text-green-800',
                'Cancelled': 'bg-red-100 text-red-800',
                'Open': 'bg-orange-100 text-orange-800',
                'Replied': 'bg-purple-100 text-purple-800',
                'Resolved': 'bg-teal-100 text-teal-800',
                'Active': 'bg-green-100 text-green-800',
                'Inactive': 'bg-gray-100 text-gray-800',
                'Expired': 'bg-red-100 text-red-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        };

        // --- MODAL COMPONENT ---
        const Modal = ({ isOpen, onClose, children, title, size = 'md', showClose = true }) => {
            if (!isOpen) return null;

            const sizeClasses = {
                sm: 'max-w-md',
                md: 'max-w-lg',
                lg: 'max-w-3xl',
                xl: 'max-w-5xl',
                full: 'max-w-full mx-4'
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-[2000] flex justify-center items-center p-4">
                    <div className={`bg-white rounded-xl shadow-2xl w-full ${sizeClasses[size]} max-h-[90vh] overflow-y-auto transform transition-all duration-300 animate-fade-in`}>
                        {title && (
                            <div className="sticky top-0 bg-white p-4 border-b flex justify-between items-center z-10">
                                <h3 className="text-xl font-bold text-amazon-dark">{title}</h3>
                                {showClose && (
                                    <button onClick={onClose} className="text-gray-500 hover:text-red-500 transition">
                                        <i className="fa-solid fa-xmark text-xl"></i>
                                    </button>
                                )}
                            </div>
                        )}
                        <div className="p-4 md:p-6">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // --- TOAST NOTIFICATION ---
        const ToastNotification = ({ message, type, onClose }) => {
            if (!message) return null;

            const baseStyle = "fixed bottom-20 md:bottom-4 right-4 p-3 rounded-lg shadow-2xl z-[2000] text-white flex items-center gap-2 max-w-sm transition-all duration-300 animate-slide-in";
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            const icons = {
                success: 'fa-circle-check',
                error: 'fa-circle-xmark',
                warning: 'fa-triangle-exclamation',
                info: 'fa-circle-info'
            };

            return (
                <div className={`${baseStyle} ${colors[type]}`}>
                    <i className={`fa-solid ${icons[type]} text-xl`}></i>
                    <p className="flex-grow text-sm font-medium">{message}</p>
                    <button onClick={onClose} className="ml-4 text-white opacity-75 hover:opacity-100 transition">
                        <i className="fa-solid fa-xmark"></i>
                    </button>
                </div>
            );
        };

        // --- CONFIRMATION MODAL ---
        const ConfirmationModal = ({ isOpen, onClose, onConfirm, title, message, confirmText = "Confirm", cancelText = "Cancel", type = "warning" }) => {
            if (!isOpen) return null;

            const typeColors = {
                warning: 'bg-yellow-500 hover:bg-yellow-600',
                danger: 'bg-red-500 hover:bg-red-600',
                success: 'bg-green-500 hover:bg-green-600'
            };

            return (
                <Modal isOpen={isOpen} onClose={onClose} title={title} size="sm">
                    <div className="space-y-4">
                        <p className="text-gray-700">{message}</p>
                        <div className="flex gap-3 justify-end pt-4">
                            <button
                                onClick={onClose}
                                className="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition"
                            >
                                {cancelText}
                            </button>
                            <button
                                onClick={() => {
                                    onConfirm();
                                    onClose();
                                }}
                                className={`px-4 py-2 rounded-lg text-white font-medium transition ${typeColors[type]}`}
                            >
                                {confirmText}
                            </button>
                        </div>
                    </div>
                </Modal>
            );
        };

        // --- PAGINATION COMPONENT ---
        const Pagination = ({ currentPage, totalPages, onPageChange, className = "" }) => {
            if (totalPages <= 1) return null;

            const pages = [];
            const showPages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(showPages / 2));
            let endPage = Math.min(totalPages, startPage + showPages - 1);

            if (endPage - startPage + 1 < showPages) {
                startPage = Math.max(1, endPage - showPages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                pages.push(i);
            }

            return (
                <div className={`flex items-center justify-center space-x-2 ${className}`}>
                    <button
                        onClick={() => onPageChange(currentPage - 1)}
                        disabled={currentPage === 1}
                        className="px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
                    >
                        <i className="fa-solid fa-chevron-left"></i>
                    </button>

                    {startPage > 1 && (
                        <>
                            <button
                                onClick={() => onPageChange(1)}
                                className="px-3 py-1 border rounded-lg hover:bg-gray-100"
                            >
                                1
                            </button>
                            {startPage > 2 && <span className="px-2">...</span>}
                        </>
                    )}

                    {pages.map(page => (
                        <button
                            key={page}
                            onClick={() => onPageChange(page)}
                            className={`px-3 py-1 border rounded-lg ${currentPage === page ? 'bg-amazon-yellow text-amazon-dark' : 'hover:bg-gray-100'}`}
                        >
                            {page}
                        </button>
                    ))}

                    {endPage < totalPages && (
                        <>
                            {endPage < totalPages - 1 && <span className="px-2">...</span>}
                            <button
                                onClick={() => onPageChange(totalPages)}
                                className="px-3 py-1 border rounded-lg hover:bg-gray-100"
                            >
                                {totalPages}
                            </button>
                        </>
                    )}

                    <button
                        onClick={() => onPageChange(currentPage + 1)}
                        disabled={currentPage === totalPages}
                        className="px-3 py-1 border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
                    >
                        <i className="fa-solid fa-chevron-right"></i>
                    </button>
                </div>
            );
        };

        // --- SEARCH COMPONENT ---
        const SearchBar = ({ value, onChange, placeholder = "Search...", className = "" }) => (
            <div className={`relative ${className}`}>
                <i className="fa-solid fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <input
                    type="text"
                    value={value}
                    onChange={(e) => onChange(e.target.value)}
                    placeholder={placeholder}
                    className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amazon-yellow focus:border-amazon-yellow"
                />
                {value && (
                    <button
                        onClick={() => onChange('')}
                        className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                    >
                        <i className="fa-solid fa-times"></i>
                    </button>
                )}
            </div>
        );

        // --- FILTER COMPONENT ---
        const FilterSelect = ({ value, onChange, options, placeholder = "Filter...", className = "" }) => (
            <select
                value={value}
                onChange={(e) => onChange(e.target.value)}
                className={`border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amazon-yellow ${className}`}
            >
                <option value="">{placeholder}</option>
                {options.map(option => (
                    <option key={option.value} value={option.value}>
                        {option.label}
                    </option>
                ))}
            </select>
        );

        // --- DATA TABLE COMPONENT ---
        const DataTable = ({
            columns,
            data,
            isLoading,
            onRowClick,
            actions = [],
            pagination = null,
            emptyMessage = "No data found"
        }) => {
            if (isLoading) return <ShimmerLoader count={5} />;

            if (!data || data.length === 0) {
                return (
                    <div className="text-center py-10">
                        <i className="fa-solid fa-inbox text-4xl text-gray-400 mb-3"></i>
                        <p className="text-gray-500">{emptyMessage}</p>
                    </div>
                );
            }

            return (
                <div className="overflow-x-auto bg-white rounded-lg shadow">
                    <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                            <tr>
                                {columns.map((column, index) => (
                                    <th
                                        key={index}
                                        className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                                    >
                                        {column.header}
                                    </th>
                                ))}
                                {actions.length > 0 && (
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Actions
                                    </th>
                                )}
                            </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {data.map((row, rowIndex) => (
                                <tr
                                    key={rowIndex}
                                    className={`hover:bg-gray-50 ${onRowClick ? 'cursor-pointer' : ''}`}
                                    onClick={() => onRowClick && onRowClick(row)}
                                >
                                    {columns.map((column, colIndex) => (
                                        <td key={colIndex} className="px-6 py-4 whitespace-nowrap">
                                            {column.render ? column.render(row[column.key], row) : row[column.key]}
                                        </td>
                                    ))}
                                    {actions.length > 0 && (
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <div className="flex space-x-2">
                                                {actions.map((action, actionIndex) => (
                                                    <button
                                                        key={actionIndex}
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            action.onClick(row);
                                                        }}
                                                        className={`px-2 py-1 rounded text-xs ${action.className}`}
                                                        title={action.title}
                                                    >
                                                        <i className={`fa-solid ${action.icon}`}></i>
                                                        {action.showLabel && <span className="ml-1">{action.label}</span>}
                                                    </button>
                                                ))}
                                            </div>
                                        </td>
                                    )}
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    {pagination && (
                        <div className="px-6 py-4 border-t">
                            <Pagination {...pagination} />
                        </div>
                    )}
                </div>
            );
        };

        // --- STATS CARD COMPONENT ---
        const StatsCard = ({ title, value, icon, color = 'blue', change = null, subtitle = '' }) => {
            const colors = {
                blue: 'bg-blue-500',
                green: 'bg-green-500',
                yellow: 'bg-yellow-500',
                red: 'bg-red-500',
                purple: 'bg-purple-500',
                pink: 'bg-pink-500'
            };

            return (
                <div className="bg-white rounded-lg shadow p-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-sm font-medium text-gray-600">{title}</p>
                            <p className="text-2xl font-bold text-gray-900 mt-1">{value}</p>
                            {subtitle && <p className="text-xs text-gray-500 mt-1">{subtitle}</p>}
                        </div>
                        <div className={`${colors[color]} text-white p-3 rounded-lg`}>
                            <i className={`fa-solid ${icon} text-xl`}></i>
                        </div>
                    </div>
                    {change && (
                        <div className="mt-4 flex items-center text-sm">
                            <span className={`flex items-center ${change > 0 ? 'text-green-600' : 'text-red-600'}`}>
                                <i className={`fa-solid ${change > 0 ? 'fa-arrow-up' : 'fa-arrow-down'} mr-1`}></i>
                                {Math.abs(change)}%
                            </span>
                            <span className="text-gray-500 ml-2">from last month</span>
                        </div>
                    )}
                </div>
            );
        };

        // --- OFFER BADGE COMPONENT ---
        const OfferBadge = ({ offer }) => {
            if (!offer) return null;

            const getOfferText = () => {
                if (offer.type === 'percentage') {
                    return `-${offer.value}%`;
                } else if (offer.type === 'fixed') {
                    return `-₹${offer.value}`;
                } else if (offer.type === 'bogo') {
                    return 'BOGO';
                } else if (offer.type === 'free_shipping') {
                    return 'Free Shipping';
                }
                return 'Offer';
            };

            const getOfferColor = () => {
                if (offer.priority === 'high') return 'bg-red-500';
                if (offer.priority === 'medium') return 'bg-orange-500';
                return 'bg-green-500';
            };

            return (
                <div className={`${getOfferColor()} text-white px-2 py-1 rounded-full text-xs font-bold`}>
                    {getOfferText()}
                </div>
            );
        };

        // ==========================================
        //  API HOOK
        // ==========================================
        const useApi = () => {
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const post = useCallback(async (data) => {
                if (API_URL.includes("PLACEHOLDER")) {
                    setError("API URL not configured. Cannot perform action.");
                    return { status: 'error', message: 'API not configured' };
                }
                setIsLoading(true);
                setError(null);
                try {
                    const res = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    const result = await res.json();
                    if (result.status === 'error') {
                        setError(result.message || "An unknown error occurred.");
                    }
                    return result;
                } catch (err) {
                    setError("Network or API connection failed.");
                    console.error("API Error:", err);
                    return { status: 'error', message: 'Connection Error' };
                } finally {
                    setIsLoading(false);
                }
            }, []);

            const get = useCallback(async (params = {}) => {
                if (API_URL.includes("PLACEHOLDER")) {
                    setError("API URL not configured. Cannot fetch data.");
                    return [];
                }
                setIsLoading(true);
                setError(null);
                try {
                    const url = new URL(API_URL);
                    Object.keys(params).forEach(key => {
                        if (params[key] !== undefined && params[key] !== null) {
                            url.searchParams.append(key, params[key]);
                        }
                    });
                    const res = await fetch(url.toString());
                    const data = await res.json();
                    return Array.isArray(data) ? data : (data.status === 'success' ? data.data || [] : []);
                } catch (err) {
                    setError("Network or API connection failed.");
                    console.error("API Fetch Error:", err);
                    return [];
                } finally {
                    setIsLoading(false);
                }
            }, []);

            return { post, get, isLoading, error, setError };
        };

        // ==========================================
        //  AUTHENTICATION COMPONENTS
        // ==========================================
        const AuthView = ({ mode, post, setView, setUser, setError, showToast }) => {
            const [form, setForm] = useState({ name: '', email: '', password: '', phone: '' });
            const [confirmPassword, setConfirmPassword] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError(null);

                if (mode === 'register') {
                    if (form.password !== confirmPassword) {
                        setError("Passwords do not match");
                        showToast("Passwords do not match", 'error');
                        return;
                    }
                    if (form.password.length < 6) {
                        setError("Password must be at least 6 characters");
                        showToast("Password must be at least 6 characters", 'error');
                        return;
                    }
                }

                const res = await post({ ...form, action: mode });
                if (res.status === 'success') {
                    setUser(res.user);
                    localStorage.setItem('muruganUser', JSON.stringify(res.user));
                    localStorage.setItem('muruganToken', res.token || 'demo-token');
                    showToast(`Welcome ${mode === 'login' ? 'back' : ''}, ${res.user.name.split(' ')[0]}!`, 'success');
                    setView('home');
                } else {
                    setError(res.message);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-gray-100 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
                        <div className="text-center mb-8">
                            <h2 className="text-3xl font-bold text-amazon-dark mb-2">
                                {mode === 'login' ? 'Welcome Back!' : 'Join Murugan Store'}
                            </h2>
                            <p className="text-gray-600">
                                {mode === 'login'
                                    ? 'Sign in to your account'
                                    : 'Create your account to start shopping'}
                            </p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-5">
                            {mode === 'register' && (
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Full Name
                                    </label>
                                    <div className="relative">
                                        <i className="fa-solid fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                        <input
                                            type="text"
                                            required
                                            className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                            placeholder="Enter your name"
                                            value={form.name}
                                            onChange={e => setForm({...form, name: e.target.value})}
                                        />
                                    </div>
                                </div>
                            )}

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Email Address
                                </label>
                                <div className="relative">
                                    <i className="fa-solid fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    <input
                                        type="email"
                                        required
                                        className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                        placeholder="Enter your email"
                                        value={form.email}
                                        onChange={e => setForm({...form, email: e.target.value})}
                                    />
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Password
                                </label>
                                <div className="relative">
                                    <i className="fa-solid fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    <input
                                        type="password"
                                        required
                                        className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                        placeholder="Enter your password"
                                        value={form.password}
                                        onChange={e => setForm({...form, password: e.target.value})}
                                    />
                                </div>
                            </div>

                            {mode === 'register' && (
                                <>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Confirm Password
                                        </label>
                                        <div className="relative">
                                            <i className="fa-solid fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                            <input
                                                type="password"
                                                required
                                                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                                placeholder="Confirm your password"
                                                value={confirmPassword}
                                                onChange={e => setConfirmPassword(e.target.value)}
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Phone Number
                                        </label>
                                        <div className="relative">
                                            <i className="fa-solid fa-phone absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                            <input
                                                type="tel"
                                                required
                                                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                                placeholder="Enter your phone number"
                                                value={form.phone}
                                                onChange={e => setForm({...form, phone: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                </>
                            )}

                            {mode === 'login' && (
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center">
                                        <input
                                            type="checkbox"
                                            id="remember"
                                            className="h-4 w-4 text-amazon-yellow rounded"
                                        />
                                        <label htmlFor="remember" className="ml-2 text-sm text-gray-600">
                                            Remember me
                                        </label>
                                    </div>
                                    <button
                                        type="button"
                                        onClick={() => showToast("Password reset feature coming soon", 'info')}
                                        className="text-sm text-amazon-blue hover:underline"
                                    >
                                        Forgot password?
                                    </button>
                                </div>
                            )}

                            <button
                                type="submit"
                                className="w-full bg-gradient-to-r from-amazon-yellow to-amazon-orange text-amazon-dark py-3 rounded-lg font-bold hover:opacity-90 transition-all transform hover:-translate-y-0.5 shadow-lg"
                            >
                                {mode === 'login' ? 'Sign In' : 'Create Account'}
                            </button>
                        </form>

                        <div className="mt-6 pt-6 border-t text-center">
                            <p className="text-gray-600">
                                {mode === 'login' ? "Don't have an account?" : "Already have an account?"}
                                <button
                                    onClick={() => setView(mode === 'login' ? 'register' : 'login')}
                                    className="ml-2 font-bold text-amazon-blue hover:text-amazon-dark"
                                >
                                    {mode === 'login' ? 'Sign Up' : 'Sign In'}
                                </button>
                            </p>
                        </div>

                        {mode === 'login' && (
                            <div className="mt-6">
                                <div className="relative">
                                    <div className="absolute inset-0 flex items-center">
                                        <div className="w-full border-t border-gray-300"></div>
                                    </div>
                                    <div className="relative flex justify-center text-sm">
                                        <span className="px-2 bg-white text-gray-500">Or continue with</span>
                                    </div>
                                </div>
                                <div className="mt-4 grid grid-cols-2 gap-3">
                                    <button
                                        onClick={() => showToast("Google login coming soon", 'info')}
                                        className="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                                    >
                                        <i className="fa-brands fa-google text-red-500 mr-2"></i>
                                        Google
                                    </button>
                                    <button
                                        onClick={() => showToast("Facebook login coming soon", 'info')}
                                        className="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                                    >
                                        <i className="fa-brands fa-facebook text-blue-600 mr-2"></i>
                                        Facebook
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ==========================================
        //  HOME PAGE COMPONENTS
        // ==========================================

        // --- HERO BANNER ---
        const HeroBanner = ({ offers }) => {
            const [currentSlide, setCurrentSlide] = useState(0);

            const slides = [
                {
                    title: "Biggest Sale of the Year!",
                    subtitle: "Up to 70% OFF on selected items",
                    bgColor: "from-purple-600 to-pink-600",
                    buttonText: "Shop Now",
                    icon: "fa-tags"
                },
                {
                    title: "Free Shipping Available",
                    subtitle: "On orders above ₹999",
                    bgColor: "from-blue-600 to-teal-500",
                    buttonText: "Learn More",
                    icon: "fa-truck"
                },
                {
                    title: "New Arrivals",
                    subtitle: "Fresh products added daily",
                    bgColor: "from-green-500 to-emerald-600",
                    buttonText: "Explore",
                    icon: "fa-star"
                }
            ];

            useEffect(() => {
                const interval = setInterval(() => {
                    setCurrentSlide((prev) => (prev + 1) % slides.length);
                }, 5000);
                return () => clearInterval(interval);
            }, []);

            return (
                <div className="relative overflow-hidden rounded-xl mb-6">
                    <div className="relative h-64 md:h-80">
                        {slides.map((slide, index) => (
                            <div
                                key={index}
                                className={`absolute inset-0 transition-opacity duration-1000 ease-in-out ${
                                    index === currentSlide ? 'opacity-100' : 'opacity-0'
                                }`}
                            >
                                <div className={`h-full bg-gradient-to-r ${slide.bgColor} flex items-center justify-between p-8`}>
                                    <div className="text-white max-w-lg">
                                        <h1 className="text-3xl md:text-4xl font-bold mb-2">{slide.title}</h1>
                                        <p className="text-lg mb-4 opacity-90">{slide.subtitle}</p>
                                        <button className="bg-white text-gray-800 px-6 py-2 rounded-lg font-bold hover:bg-gray-100 transition">
                                            <i className={`fa-solid ${slide.icon} mr-2`}></i>
                                            {slide.buttonText}
                                        </button>
                                    </div>
                                    <div className="hidden md:block">
                                        <i className={`fa-solid ${slide.icon} text-white text-8xl opacity-20`}></i>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Slide Indicators */}
                    <div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                        {slides.map((_, index) => (
                            <button
                                key={index}
                                onClick={() => setCurrentSlide(index)}
                                className={`w-2 h-2 rounded-full transition-all ${
                                    index === currentSlide ? 'bg-white w-8' : 'bg-white opacity-50'
                                }`}
                            />
                        ))}
                    </div>
                </div>
            );
        };

        // --- CATEGORIES SECTION ---
        const CategoriesSection = ({ categories, onCategoryClick }) => {
            const popularCategories = [
                { name: 'Groceries', icon: 'fa-carrot', color: 'bg-orange-500' },
                { name: 'Electronics', icon: 'fa-laptop', color: 'bg-blue-500' },
                { name: 'Fashion', icon: 'fa-tshirt', color: 'bg-pink-500' },
                { name: 'Home & Kitchen', icon: 'fa-home', color: 'bg-green-500' },
                { name: 'Beauty', icon: 'fa-spa', color: 'bg-purple-500' },
                { name: 'Sports', icon: 'fa-dumbbell', color: 'bg-red-500' }
            ];

            return (
                <div className="mb-8">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">Shop by Category</h2>
                    <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4">
                        {popularCategories.map((cat, index) => (
                            <button
                                key={index}
                                onClick={() => onCategoryClick(cat.name)}
                                className="bg-white p-4 rounded-xl shadow hover:shadow-lg transition-all transform hover:-translate-y-1"
                            >
                                <div className={`${cat.color} text-white w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-2`}>
                                    <i className={`fa-solid ${cat.icon} text-xl`}></i>
                                </div>
                                <p className="text-sm font-medium text-gray-700 truncate">{cat.name}</p>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- OFFERS SECTION ---
        const OffersSection = ({ offers }) => {
            const activeOffers = offers.filter(o => o.status === 'Active').slice(0, 4);

            if (activeOffers.length === 0) return null;

            return (
                <div className="mb-8">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-2xl font-bold text-gray-800">Today's Best Offers</h2>
                        <button className="text-amazon-blue hover:underline font-medium">
                            View All <i className="fa-solid fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {activeOffers.map(offer => (
                            <div key={offer.id} className="bg-white rounded-xl shadow p-4 border-l-4 border-amazon-yellow">
                                <div className="flex items-center justify-between mb-2">
                                    <OfferBadge offer={offer} />
                                    <span className="text-xs text-gray-500">
                                        {offer.type === 'percentage' ? `${offer.value}% OFF` :
                                         offer.type === 'fixed' ? `₹${offer.value} OFF` :
                                         offer.type === 'bogo' ? 'Buy 1 Get 1' : 'Special Offer'}
                                    </span>
                                </div>
                                <h3 className="font-bold text-gray-800 mb-1">{offer.title}</h3>
                                <p className="text-sm text-gray-600 mb-3 line-clamp-2">{offer.description}</p>
                                <div className="flex items-center justify-between text-xs text-gray-500">
                                    <span>
                                        <i className="fa-solid fa-clock mr-1"></i>
                                        Ends: {offer.endDate}
                                    </span>
                                    <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">
                                        Code: {offer.code}
                                    </span>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- FEATURED PRODUCTS ---
        const FeaturedProducts = ({ products, onAddToCart, onQuickView }) => {
            const featured = products.slice(0, 8);

            return (
                <div className="mb-8">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-2xl font-bold text-gray-800">Featured Products</h2>
                        <button className="text-amazon-blue hover:underline font-medium">
                            See All <i className="fa-solid fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-4">
                        {featured.map(product => (
                            <ProductCard
                                key={product.id}
                                product={product}
                                onAddToCart={onAddToCart}
                                onQuickView={onQuickView}
                                showDiscount={true}
                            />
                        ))}
                    </div>
                </div>
            );
        };

        // --- PRODUCT CARD ---
        const ProductCard = ({ product, onAddToCart, onQuickView, showDiscount = false }) => {
            const [isHovered, setIsHovered] = useState(false);

            const discount = showDiscount && product.discount ? Math.round((1 - product.salePrice / product.price) * 100) : 0;

            return (
                <div
                    className="product-card bg-white rounded-lg shadow p-4 flex flex-col h-full relative"
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                >
                    {showDiscount && discount > 0 && (
                        <div className="discount-badge">
                            -{discount}%
                        </div>
                    )}

                    <div className="relative mb-3">
                        <img
                            src={product.image || 'https://placehold.co/300x200'}
                            onError={(e) => {
                                e.target.onerror = null;
                                e.target.src = 'https://placehold.co/300x200';
                            }}
                            alt={product.name}
                            className="w-full h-40 object-contain cursor-pointer"
                            onClick={() => onQuickView(product)}
                        />
                        <button
                            onClick={() => onQuickView(product)}
                            className="absolute top-2 right-2 bg-white p-2 rounded-full shadow hover:bg-gray-100 transition"
                            title="Quick View"
                        >
                            <i className="fa-solid fa-eye text-gray-600"></i>
                        </button>
                    </div>

                    <div className="flex-grow">
                        <p className="text-xs text-gray-500 font-medium uppercase mb-1">{product.category}</p>
                        <h3
                            className="font-semibold text-gray-800 mb-2 line-clamp-2 cursor-pointer hover:text-amazon-blue transition"
                            onClick={() => onQuickView(product)}
                        >
                            {product.name}
                        </h3>
                        <div className="flex items-center mb-3">
                            <div className="flex items-center">
                                {[1, 2, 3, 4, 5].map((star) => (
                                    <i
                                        key={star}
                                        className={`fa-solid fa-star text-sm ${
                                            star <= Math.floor(product.rating || 4)
                                                ? 'text-yellow-400'
                                                : 'text-gray-300'
                                        }`}
                                    ></i>
                                ))}
                                <span className="text-xs text-gray-500 ml-1">
                                    ({product.reviews || 25})
                                </span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div className="flex items-center justify-between mb-3">
                            <div>
                                <p className="text-lg font-bold text-red-600">
                                    ₹{product.salePrice || product.price}
                                </p>
                                {showDiscount && discount > 0 && (
                                    <p className="text-sm text-gray-500 line-through">
                                        ₹{product.price}
                                    </p>
                                )}
                            </div>
                            {product.stock && (
                                <div className={`text-xs px-2 py-1 rounded-full ${
                                    product.stock > 10
                                        ? 'bg-green-100 text-green-800'
                                        : product.stock > 0
                                        ? 'bg-yellow-100 text-yellow-800'
                                        : 'bg-red-100 text-red-800'
                                }`}>
                                    {product.stock > 10 ? 'In Stock' : product.stock > 0 ? 'Low Stock' : 'Out of Stock'}
                                </div>
                            )}
                        </div>

                        <button
                            onClick={() => onAddToCart(product)}
                            disabled={product.stock === 0}
                            className={`w-full py-2 rounded-lg font-bold transition-all ${
                                product.stock === 0
                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                    : isHovered
                                    ? 'bg-amazon-orange text-white'
                                    : 'bg-amazon-yellow text-amazon-dark hover:bg-amazon-orange'
                            }`}
                        >
                            {product.stock === 0 ? (
                                <>
                                    <i className="fa-solid fa-ban mr-1"></i> Out of Stock
                                </>
                            ) : (
                                <>
                                    <i className="fa-solid fa-cart-plus mr-1"></i> Add to Cart
                                </>
                            )}
                        </button>
                    </div>
                </div>
            );
        };

        // --- QUICK VIEW MODAL ---
        const ProductQuickView = ({ product, onClose, onAddToCart }) => {
            if (!product) return null;

            const [selectedImage, setSelectedImage] = useState(product.image);
            const [quantity, setQuantity] = useState(1);

            const handleAddToCart = () => {
                const productToAdd = { ...product, qty: quantity };
                onAddToCart(productToAdd);
                onClose();
            };

            return (
                <Modal isOpen={!!product} onClose={onClose} title={product.name} size="lg">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        {/* Product Images */}
                        <div>
                            <div className="bg-gray-50 rounded-lg p-4 mb-4">
                                <img
                                    src={selectedImage || product.image}
                                    onError={(e) => {
                                        e.target.onerror = null;
                                        e.target.src = 'https://placehold.co/500x400';
                                    }}
                                    alt={product.name}
                                    className="w-full h-64 object-contain"
                                />
                            </div>
                            <div className="flex space-x-2 overflow-x-auto">
                                {[product.image, ...(product.images || [])].slice(0, 4).map((img, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => setSelectedImage(img)}
                                        className={`flex-shrink-0 w-16 h-16 border-2 rounded ${
                                            selectedImage === img
                                            ? 'border-amazon-yellow'
                                            : 'border-gray-200'
                                        }`}
                                    >
                                        <img
                                            src={img}
                                            alt={`Product view ${idx + 1}`}
                                            className="w-full h-full object-contain"
                                        />
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Product Details */}
                        <div className="space-y-4">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-500">Category: {product.category}</p>
                                    <div className="flex items-center mt-1">
                                        {[1, 2, 3, 4, 5].map(star => (
                                            <i
                                                key={star}
                                                className={`fa-solid fa-star text-sm ${
                                                    star <= Math.floor(product.rating || 4)
                                                        ? 'text-yellow-400'
                                                        : 'text-gray-300'
                                                }`}
                                            ></i>
                                        ))}
                                        <span className="text-sm text-gray-500 ml-2">
                                            ({product.reviews || 25} reviews)
                                        </span>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <p className="text-3xl font-bold text-red-600">
                                        ₹{product.salePrice || product.price}
                                    </p>
                                    {product.discount && (
                                        <p className="text-sm text-gray-500 line-through">
                                            ₹{product.price}
                                        </p>
                                    )}
                                </div>
                            </div>

                            <div className="border-t border-b py-4">
                                <h4 className="font-bold text-gray-800 mb-2">Description</h4>
                                <p className="text-gray-600">{product.description || 'No description available.'}</p>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Quantity
                                    </label>
                                    <div className="flex items-center space-x-4">
                                        <div className="flex items-center border rounded-lg">
                                            <button
                                                onClick={() => setQuantity(Math.max(1, quantity - 1))}
                                                className="px-3 py-2 hover:bg-gray-100"
                                            >
                                                <i className="fa-solid fa-minus"></i>
                                            </button>
                                            <span className="px-4 py-2 border-x">{quantity}</span>
                                            <button
                                                onClick={() => setQuantity(quantity + 1)}
                                                className="px-3 py-2 hover:bg-gray-100"
                                            >
                                                <i className="fa-solid fa-plus"></i>
                                            </button>
                                        </div>
                                        <div className="text-sm text-gray-500">
                                            {product.stock || 100} items available
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-3">
                                    <button
                                        onClick={handleAddToCart}
                                        className="bg-amazon-yellow text-amazon-dark py-3 rounded-lg font-bold hover:bg-amazon-orange transition"
                                    >
                                        <i className="fa-solid fa-cart-plus mr-2"></i>
                                        Add to Cart
                                    </button>
                                    <button
                                        onClick={() => {
                                            handleAddToCart();
                                            onClose();
                                        }}
                                        className="bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 transition"
                                    >
                                        <i className="fa-solid fa-bolt mr-2"></i>
                                        Buy Now
                                    </button>
                                </div>

                                <div className="flex space-x-4 text-sm text-gray-600">
                                    <div className="flex items-center">
                                        <i className="fa-solid fa-truck text-green-600 mr-2"></i>
                                        <span>Free Shipping</span>
                                    </div>
                                    <div className="flex items-center">
                                        <i className="fa-solid fa-rotate-left text-blue-600 mr-2"></i>
                                        <span>30 Days Return</span>
                                    </div>
                                    <div className="flex items-center">
                                        <i className="fa-solid fa-shield-alt text-purple-600 mr-2"></i>
                                        <span>1 Year Warranty</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </Modal>
            );
        };

        // ==========================================
        //  CART & CHECKOUT COMPONENTS
        // ==========================================

        // --- CART VIEW ---
        const CartView = ({ cart, changeQty, total, setView, user, applyCoupon, appliedCoupon, removeCoupon }) => {
            const [couponCode, setCouponCode] = useState('');
            const [isApplyingCoupon, setIsApplyingCoupon] = useState(false);
            const subtotal = cart.reduce((acc, item) => acc + (item.salePrice || item.price) * item.qty, 0);
            const totalItems = cart.reduce((acc, item) => acc + item.qty, 0);
            const discount = appliedCoupon ? (appliedCoupon.discountAmount || 0) : 0;

            const handleApplyCoupon = async () => {
                if (!couponCode.trim()) return;
                setIsApplyingCoupon(true);
                await applyCoupon(couponCode, subtotal);
                setIsApplyingCoupon(false);
            };

            if (cart.length === 0) {
                return (
                    <div className="max-w-screen-xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                        <h2 className="text-2xl md:text-3xl font-bold mb-6 text-amazon-dark border-b pb-3">
                            Your Shopping Cart
                        </h2>
                        <div className="text-center p-10 bg-white rounded-xl shadow-lg">
                            <i className="fa-solid fa-shopping-cart text-6xl text-gray-300 mb-4"></i>
                            <h3 className="text-xl font-bold text-gray-700 mb-2">Your cart is empty</h3>
                            <p className="text-gray-500 mb-6">Add some items to get started!</p>
                            <button
                                onClick={() => setView('home')}
                                className="bg-amazon-yellow text-amazon-dark px-6 py-3 rounded-lg font-bold hover:bg-amazon-orange transition"
                            >
                                <i className="fa-solid fa-store mr-2"></i>
                                Continue Shopping
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-screen-xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <h2 className="text-2xl md:text-3xl font-bold mb-6 text-amazon-dark border-b pb-3">
                        Shopping Cart ({totalItems} Items)
                    </h2>

                    <div className="flex flex-col lg:flex-row gap-6">
                        {/* Cart Items */}
                        <div className="lg:w-2/3">
                            <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                <div className="p-4 bg-gray-50 border-b">
                                    <h3 className="font-bold text-gray-800">Items in Cart</h3>
                                </div>
                                <div className="divide-y">
                                    {cart.map(item => (
                                        <div key={item.id} className="p-4 flex items-start md:items-center gap-4">
                                            <img
                                                src={item.image}
                                                alt={item.name}
                                                className="w-20 h-20 object-contain border rounded-lg"
                                            />
                                            <div className="flex-grow">
                                                <h4 className="font-bold text-gray-800">{item.name}</h4>
                                                <p className="text-sm text-gray-500 mb-2">{item.category}</p>
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center space-x-4">
                                                        <div className="flex items-center border rounded-lg">
                                                            <button
                                                                onClick={() => changeQty(item.id, -1)}
                                                                className="px-3 py-1 hover:bg-gray-100"
                                                            >
                                                                <i className="fa-solid fa-minus"></i>
                                                            </button>
                                                            <span className="px-3 py-1 border-x">{item.qty}</span>
                                                            <button
                                                                onClick={() => changeQty(item.id, 1)}
                                                                className="px-3 py-1 hover:bg-gray-100"
                                                            >
                                                                <i className="fa-solid fa-plus"></i>
                                                            </button>
                                                        </div>
                                                        <button
                                                            onClick={() => changeQty(item.id, -item.qty)}
                                                            className="text-red-500 hover:text-red-700"
                                                        >
                                                            <i className="fa-solid fa-trash"></i> Remove
                                                        </button>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="font-bold text-lg text-red-600">
                                                            ₹{((item.salePrice || item.price) * item.qty).toFixed(2)}
                                                        </p>
                                                        <p className="text-sm text-gray-500">
                                                            ₹{(item.salePrice || item.price).toFixed(2)} each
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Order Summary */}
                        <div className="lg:w-1/3">
                            <div className="bg-white rounded-xl shadow-lg p-6 sticky top-24">
                                <h3 className="font-bold text-xl mb-4">Order Summary</h3>

                                {/* Coupon Section */}
                                <div className="mb-4 p-4 bg-gray-50 rounded-lg">
                                    <div className="flex gap-2 mb-2">
                                        <input
                                            type="text"
                                            value={couponCode}
                                            onChange={(e) => setCouponCode(e.target.value.toUpperCase())}
                                            placeholder="Enter coupon code"
                                            className="flex-grow border rounded-lg px-3 py-2"
                                            disabled={!!appliedCoupon}
                                        />
                                        {appliedCoupon ? (
                                            <button
                                                onClick={removeCoupon}
                                                className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
                                            >
                                                Remove
                                            </button>
                                        ) : (
                                            <button
                                                onClick={handleApplyCoupon}
                                                disabled={isApplyingCoupon || !couponCode.trim()}
                                                className="bg-amazon-yellow text-amazon-dark px-4 py-2 rounded-lg hover:bg-amazon-orange disabled:opacity-50"
                                            >
                                                {isApplyingCoupon ? 'Applying...' : 'Apply'}
                                            </button>
                                        )}
                                    </div>
                                    {appliedCoupon && (
                                        <div className="text-green-600 text-sm">
                                            <i className="fa-solid fa-check-circle mr-1"></i>
                                            Coupon {appliedCoupon.code} applied! Saved ₹{appliedCoupon.discountAmount}
                                        </div>
                                    )}
                                </div>

                                {/* Price Breakdown */}
                                <div className="space-y-2 mb-4">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Subtotal ({totalItems} items)</span>
                                        <span>₹{subtotal.toFixed(2)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Shipping</span>
                                        <span className="text-green-600">FREE</span>
                                    </div>
                                    {appliedCoupon && (
                                        <div className="flex justify-between text-green-600">
                                            <span>Coupon Discount</span>
                                            <span>-₹{discount.toFixed(2)}</span>
                                        </div>
                                    )}
                                    <div className="border-t pt-2">
                                        <div className="flex justify-between font-bold text-lg">
                                            <span>Total Amount</span>
                                            <span className="text-red-600">₹{total.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Proceed to Checkout */}
                                <button
                                    onClick={() => setView('address')}
                                    className="w-full bg-gradient-to-r from-amazon-yellow to-amazon-orange text-amazon-dark py-3 rounded-lg font-bold hover:opacity-90 transition mb-3"
                                >
                                    <i className="fa-solid fa-lock mr-2"></i>
                                    Proceed to Checkout
                                </button>

                                <p className="text-xs text-gray-500 text-center">
                                    <i className="fa-solid fa-shield-alt mr-1"></i>
                                    Secure checkout powered by Murugan Store
                                </p>

                                {/* Offers */}
                                <div className="mt-4 pt-4 border-t">
                                    <h4 className="font-bold text-gray-700 mb-2">Available Offers</h4>
                                    <ul className="text-sm text-gray-600 space-y-1">
                                        <li className="flex items-center">
                                            <i className="fa-solid fa-tag text-green-500 mr-2"></i>
                                            Get 10% off on orders above ₹1000
                                        </li>
                                        <li className="flex items-center">
                                            <i className="fa-solid fa-gift text-blue-500 mr-2"></i>
                                            Free shipping on orders above ₹999
                                        </li>
                                        <li className="flex items-center">
                                            <i className="fa-solid fa-bolt text-orange-500 mr-2"></i>
                                            Extra 5% off for first-time users
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ADDRESS VIEW ---
        const AddressView = ({ user, setView, address, setAddress, city, setCity, pincode, setPincode, showToast }) => {
            const [savedAddresses, setSavedAddresses] = useState([]);
            const [selectedAddress, setSelectedAddress] = useState(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!address || !city || !pincode) {
                    showToast("Please fill in all address details", 'error');
                    return;
                }
                if (pincode.length !== 6 || isNaN(pincode)) {
                    showToast("Pincode must be a 6-digit number", 'error');
                    return;
                }
                showToast("Address saved successfully", 'success');
                setView('checkout');
            };

            return (
                <div className="max-w-screen-md mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <h2 className="text-2xl md:text-3xl font-bold mb-6 text-amazon-dark border-b pb-3">
                        Shipping Address
                    </h2>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <div className="mb-6">
                            <h3 className="text-lg font-bold text-amazon-blue mb-2">Deliver to: {user?.name}</h3>
                            <p className="text-gray-600">{user?.email} | {user?.phone}</p>
                        </div>

                        {/* Saved Addresses */}
                        {savedAddresses.length > 0 && (
                            <div className="mb-6">
                                <h4 className="font-bold text-gray-700 mb-3">Select from saved addresses</h4>
                                <div className="space-y-3">
                                    {savedAddresses.map((addr, idx) => (
                                        <label key={idx} className="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                            <input
                                                type="radio"
                                                name="address"
                                                checked={selectedAddress === idx}
                                                onChange={() => {
                                                    setSelectedAddress(idx);
                                                    setAddress(addr.address);
                                                    setCity(addr.city);
                                                    setPincode(addr.pincode);
                                                }}
                                                className="mt-1 mr-3"
                                            />
                                            <div>
                                                <p className="font-medium">{addr.address}</p>
                                                <p className="text-sm text-gray-600">{addr.city} - {addr.pincode}</p>
                                            </div>
                                        </label>
                                    ))}
                                </div>
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Address Line (House No., Street)
                                </label>
                                <input
                                    type="text"
                                    required
                                    className="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                    placeholder="Enter your complete address"
                                    value={address}
                                    onChange={(e) => setAddress(e.target.value)}
                                />
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        City / District
                                    </label>
                                    <input
                                        type="text"
                                        required
                                        className="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                        placeholder="Enter your city"
                                        value={city}
                                        onChange={(e) => setCity(e.target.value)}
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Pincode
                                    </label>
                                    <input
                                        type="tel"
                                        pattern="\d{6}"
                                        maxLength="6"
                                        required
                                        className="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                        placeholder="6-digit pincode"
                                        value={pincode}
                                        onChange={(e) => setPincode(e.target.value.replace(/\D/g, ''))}
                                    />
                                </div>
                            </div>

                            <div className="flex items-center mt-2">
                                <input
                                    type="checkbox"
                                    id="saveAddress"
                                    className="h-4 w-4 text-amazon-yellow rounded"
                                />
                                <label htmlFor="saveAddress" className="ml-2 text-sm text-gray-600">
                                    Save this address for future use
                                </label>
                            </div>

                            <div className="pt-6 border-t">
                                <div className="flex flex-col md:flex-row gap-3">
                                    <button
                                        type="submit"
                                        className="flex-grow bg-gradient-to-r from-amazon-yellow to-amazon-orange text-amazon-dark py-3 rounded-lg font-bold hover:opacity-90 transition"
                                    >
                                        <i className="fa-solid fa-check-circle mr-2"></i>
                                        Continue to Payment
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => setView('cart')}
                                        className="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"
                                    >
                                        <i className="fa-solid fa-arrow-left mr-2"></i>
                                        Back to Cart
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // --- CHECKOUT VIEW ---
        const CheckoutView = ({
            user,
            cart,
            total,
            setView,
            post,
            updateCartStorage,
            isLoading,
            setError,
            address,
            city,
            pincode,
            showToast,
            appliedCoupon
        }) => {
            const [paymentMethod, setPaymentMethod] = useState('UPI');
            const [transactionId, setTransactionId] = useState('');
            const [orderNotes, setOrderNotes] = useState('');

            const storeUPI = 'muruganstore@upi';
            const storeName = 'Murugan Super Store';
            const finalTotal = total;
            const qrText = `upi://pay?pa=${storeUPI}&pn=${encodeURIComponent(storeName)}&am=${finalTotal.toFixed(2)}&cu=INR`;
            const qrImageUrl = `https://quickchart.io/qr?text=${encodeURIComponent(qrText)}&size=200&light=FFFFFF&dark=131921&margin=4`;

            const handlePlaceOrder = async () => {
                if (!user) {
                    showToast("Please login to place order", 'error');
                    return;
                }

                if (paymentMethod === 'UPI' && !transactionId.trim()) {
                    showToast("Please enter Transaction ID for UPI payment", 'error');
                    return;
                }

                if (!window.confirm(`Place order for ₹${finalTotal.toFixed(2)}?`)) {
                    return;
                }

                const orderData = {
                    action: 'placeOrder',
                    email: user.email,
                    total: finalTotal.toFixed(2),
                    items: cart,
                    address: `${address}, ${city}, ${pincode}`,
                    transactionId: paymentMethod === 'UPI' ? transactionId : 'COD',
                    paymentMethod: paymentMethod,
                    couponCode: appliedCoupon?.code || '',
                    notes: orderNotes
                };

                const res = await post(orderData);
                if (res.status === 'success') {
                    showToast(`Order #${res.orderId} placed successfully! You earned ${res.awardedCoins || 0} coins`, 'success');
                    updateCartStorage([]);
                    setView('history');
                } else {
                    showToast(`Order failed: ${res.message}`, 'error');
                }
            };

            return (
                <div className="max-w-screen-xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <h2 className="text-2xl md:text-3xl font-bold mb-6 text-amazon-dark border-b pb-3">
                        Checkout & Payment
                    </h2>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* Left Column - Payment Methods */}
                        <div className="lg:col-span-2 space-y-6">
                            {/* Order Summary Card */}
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-xl font-bold mb-4">Order Summary</h3>
                                <div className="space-y-3">
                                    {cart.map(item => (
                                        <div key={item.id} className="flex justify-between items-center pb-2 border-b">
                                            <div>
                                                <p className="font-medium">{item.name}</p>
                                                <p className="text-sm text-gray-500">Qty: {item.qty}</p>
                                            </div>
                                            <p className="font-bold">₹{((item.salePrice || item.price) * item.qty).toFixed(2)}</p>
                                        </div>
                                    ))}
                                    {appliedCoupon && (
                                        <div className="flex justify-between text-green-600">
                                            <p>Coupon Discount ({appliedCoupon.code})</p>
                                            <p>-₹{appliedCoupon.discountAmount}</p>
                                        </div>
                                    )}
                                    <div className="pt-2 border-t">
                                        <div className="flex justify-between font-bold text-lg">
                                            <p>Total Amount</p>
                                            <p className="text-red-600">₹{finalTotal.toFixed(2)}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Payment Methods */}
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-xl font-bold mb-4">Select Payment Method</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                                    {['UPI', 'Credit Card', 'Debit Card', 'COD', 'Net Banking', 'Wallet'].map(method => (
                                        <button
                                            key={method}
                                            onClick={() => setPaymentMethod(method)}
                                            className={`p-4 border-2 rounded-lg flex flex-col items-center justify-center transition ${
                                                paymentMethod === method
                                                    ? 'border-amazon-blue bg-blue-50'
                                                    : 'border-gray-200 hover:border-amazon-yellow'
                                            }`}
                                        >
                                            <i className={`fa-solid ${
                                                method === 'UPI' ? 'fa-indian-rupee-sign' :
                                                method === 'COD' ? 'fa-money-bill-wave' :
                                                method.includes('Card') ? 'fa-credit-card' :
                                                'fa-wallet'
                                            } text-2xl mb-2 ${paymentMethod === method ? 'text-amazon-blue' : 'text-gray-500'}`}></i>
                                            <span className="text-sm font-medium">{method}</span>
                                        </button>
                                    ))}
                                </div>

                                {/* UPI Payment Details */}
                                {paymentMethod === 'UPI' && (
                                    <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                                        <h4 className="font-bold mb-3">Pay ₹{finalTotal.toFixed(2)} via UPI</h4>
                                        <div className="flex flex-col md:flex-row items-center gap-6">
                                            <div className="bg-white p-4 rounded-lg shadow">
                                                <img src={qrImageUrl} alt="UPI QR Code" className="w-48 h-48" />
                                                <p className="text-center text-sm mt-2">Scan QR Code</p>
                                            </div>
                                            <div className="flex-grow">
                                                <p className="mb-2"><span className="font-semibold">UPI ID:</span> {storeUPI}</p>
                                                <p className="mb-4"><span className="font-semibold">Payee:</span> {storeName}</p>
                                                <a
                                                    href={qrText}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="inline-block bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 transition"
                                                >
                                                    <i className="fa-solid fa-external-link-alt mr-2"></i>
                                                    Open UPI App
                                                </a>
                                            </div>
                                        </div>
                                        <div className="mt-4">
                                            <label className="block text-sm font-medium mb-2">
                                                Transaction ID / UTR Number *
                                            </label>
                                            <input
                                                type="text"
                                                value={transactionId}
                                                onChange={(e) => setTransactionId(e.target.value)}
                                                placeholder="Enter 12-digit UTR"
                                                className="w-full border rounded-lg px-4 py-2"
                                                required
                                            />
                                            <p className="text-xs text-gray-500 mt-1">
                                                Enter the transaction ID from your payment app
                                            </p>
                                        </div>
                                    </div>
                                )}

                                {/* COD Details */}
                                {paymentMethod === 'COD' && (
                                    <div className="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                        <div className="flex items-center mb-2">
                                            <i className="fa-solid fa-money-bill-wave text-2xl text-yellow-600 mr-3"></i>
                                            <div>
                                                <h4 className="font-bold">Cash on Delivery</h4>
                                                <p className="text-sm">Pay when you receive your order</p>
                                            </div>
                                        </div>
                                        <ul className="text-sm text-gray-600 space-y-1">
                                            <li><i className="fa-solid fa-check text-green-500 mr-2"></i> No advance payment required</li>
                                            <li><i className="fa-solid fa-check text-green-500 mr-2"></i> Pay in cash to delivery executive</li>
                                            <li><i className="fa-solid fa-check text-green-500 mr-2"></i> Get digital receipt on email</li>
                                        </ul>
                                    </div>
                                )}

                                {/* Order Notes */}
                                <div className="mt-6">
                                    <label className="block text-sm font-medium mb-2">
                                        Order Instructions (Optional)
                                    </label>
                                    <textarea
                                        value={orderNotes}
                                        onChange={(e) => setOrderNotes(e.target.value)}
                                        placeholder="Any special instructions for delivery..."
                                        className="w-full border rounded-lg px-4 py-2 h-24"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Right Column - Order Review */}
                        <div className="space-y-6">
                            {/* Delivery Address */}
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="font-bold mb-3">Delivery Address</h3>
                                <div className="text-sm text-gray-600">
                                    <p className="font-medium">{user?.name}</p>
                                    <p>{address}</p>
                                    <p>{city}, {pincode}</p>
                                    <p>{user?.phone}</p>
                                </div>
                                <button
                                    onClick={() => setView('address')}
                                    className="mt-3 text-amazon-blue text-sm hover:underline"
                                >
                                    <i className="fa-solid fa-pen mr-1"></i> Change Address
                                </button>
                            </div>

                            {/* Order Total */}
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="font-bold mb-4">Price Details</h3>
                                <div className="space-y-2">
                                    <div className="flex justify-between">
                                        <span>Total Items</span>
                                        <span>{cart.reduce((acc, item) => acc + item.qty, 0)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Item Total</span>
                                        <span>₹{cart.reduce((acc, item) => acc + (item.salePrice || item.price) * item.qty, 0).toFixed(2)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Delivery</span>
                                        <span className="text-green-600">FREE</span>
                                    </div>
                                    {appliedCoupon && (
                                        <div className="flex justify-between text-green-600">
                                            <span>Coupon Discount</span>
                                            <span>-₹{appliedCoupon.discountAmount}</span>
                                        </div>
                                    )}
                                    <div className="border-t pt-2">
                                        <div className="flex justify-between font-bold text-lg">
                                            <span>Total Amount</span>
                                            <span className="text-red-600">₹{finalTotal.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Place Order Button */}
                            <button
                                onClick={handlePlaceOrder}
                                disabled={isLoading || (paymentMethod === 'UPI' && !transactionId.trim())}
                                className={`w-full py-4 rounded-lg font-bold text-lg transition ${
                                    isLoading || (paymentMethod === 'UPI' && !transactionId.trim())
                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                    : 'bg-gradient-to-r from-green-500 to-emerald-600 text-white hover:opacity-90'
                                }`}
                            >
                                {isLoading ? (
                                    <>
                                        <i className="fa-solid fa-spinner fa-spin mr-2"></i>
                                        Processing...
                                    </>
                                ) : (
                                    <>
                                        <i className="fa-solid fa-lock mr-2"></i>
                                        Place Order (₹{finalTotal.toFixed(2)})
                                    </>
                                )}
                            </button>

                            {/* Security Info */}
                            <div className="text-center text-xs text-gray-500">
                                <p className="mb-1">
                                    <i className="fa-solid fa-shield-alt mr-1"></i>
                                    100% Secure Payment
                                </p>
                                <p>
                                    <i className="fa-solid fa-lock mr-1"></i>
                                    Your payment information is encrypted
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        //  ORDER & ACCOUNT MANAGEMENT
        // ==========================================

        // --- ORDER HISTORY ---
        const OrderHistory = ({ user, get, setView, setSelectedOrder }) => {
            const [orders, setOrders] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [filter, setFilter] = useState('all');
            const [search, setSearch] = useState('');

            const fetchOrders = useCallback(async () => {
                if (!user) return;
                setIsLoading(true);
                const data = await get({ action: 'getOrdersByEmail', email: user.email });
                if (Array.isArray(data)) {
                    setOrders(data.sort((a, b) => new Date(b.date) - new Date(a.date)));
                }
                setIsLoading(false);
            }, [user, get]);

            useEffect(() => {
                fetchOrders();
            }, [fetchOrders]);

            const filteredOrders = orders.filter(order => {
                const matchesSearch = search === '' ||
                    order.orderId.toLowerCase().includes(search.toLowerCase()) ||
                    order.items.some(item => item.name.toLowerCase().includes(search.toLowerCase()));

                const matchesFilter = filter === 'all' || order.status === filter;

                return matchesSearch && matchesFilter;
            });

            if (!user) {
                return (
                    <div className="max-w-screen-xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav text-center">
                        <h2 className="text-2xl md:text-3xl font-bold mb-6 text-amazon-dark">Order History</h2>
                        <div className="bg-white rounded-xl shadow-lg p-10">
                            <i className="fa-solid fa-user-lock text-5xl text-gray-400 mb-4"></i>
                            <p className="text-lg text-gray-600 mb-4">Please sign in to view your orders</p>
                            <button
                                onClick={() => setView('login')}
                                className="bg-amazon-yellow text-amazon-dark px-6 py-3 rounded-lg font-bold hover:bg-amazon-orange transition"
                            >
                                Sign In to Continue
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-screen-xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <h2 className="text-2xl md:text-3xl font-bold mb-6 text-amazon-dark">
                        Order History
                    </h2>

                    {/* Filters and Search */}
                    <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                        <div className="flex flex-col md:flex-row gap-4">
                            <SearchBar
                                value={search}
                                onChange={setSearch}
                                placeholder="Search orders..."
                                className="flex-grow"
                            />
                            <FilterSelect
                                value={filter}
                                onChange={setFilter}
                                options={[
                                    { value: 'all', label: 'All Orders' },
                                    { value: 'Pending', label: 'Pending' },
                                    { value: 'Confirmed', label: 'Confirmed' },
                                    { value: 'Shipped', label: 'Shipped' },
                                    { value: 'Delivered', label: 'Delivered' },
                                    { value: 'Cancelled', label: 'Cancelled' }
                                ]}
                            />
                        </div>
                    </div>

                    {isLoading ? (
                        <ShimmerLoader count={4} />
                    ) : filteredOrders.length === 0 ? (
                        <div className="bg-white rounded-xl shadow-lg p-10 text-center">
                            <i className="fa-solid fa-receipt text-5xl text-gray-400 mb-4"></i>
                            <p className="text-lg text-gray-600 mb-2">No orders found</p>
                            <p className="text-gray-500 mb-6">Start shopping to place your first order!</p>
                            <button
                                onClick={() => setView('home')}
                                className="bg-amazon-yellow text-amazon-dark px-6 py-3 rounded-lg font-bold hover:bg-amazon-orange transition"
                            >
                                <i className="fa-solid fa-shopping-bag mr-2"></i>
                                Start Shopping
                            </button>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {filteredOrders.map(order => (
                                <div key={order.orderId} className="bg-white rounded-xl shadow-lg overflow-hidden">
                                    <div className="p-4 bg-gray-50 border-b flex flex-wrap justify-between items-center">
                                        <div>
                                            <p className="font-bold text-amazon-blue">Order #{order.orderId}</p>
                                            <p className="text-sm text-gray-500">{order.date}</p>
                                        </div>
                                        <div className="text-right">
                                            <span className={`px-3 py-1 rounded-full text-sm font-bold ${getStatusColor(order.status)}`}>
                                                {order.status}
                                            </span>
                                            <p className="font-bold text-lg mt-1">₹{parseFloat(order.total).toFixed(2)}</p>
                                        </div>
                                    </div>

                                    <div className="p-4">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <p className="text-sm text-gray-500">Delivery Address</p>
                                                <p className="font-medium">{order.address}</p>
                                            </div>
                                            <div>
                                                <p className="text-sm text-gray-500">Payment Method</p>
                                                <p className="font-medium">
                                                    {order.transactionId === 'COD' ? 'Cash on Delivery' : 'UPI Payment'}
                                                </p>
                                            </div>
                                        </div>

                                        <div className="border-t pt-4">
                                            <h4 className="font-bold mb-2">Items</h4>
                                            <div className="space-y-2">
                                                {(order.items || []).map((item, idx) => (
                                                    <div key={idx} className="flex items-center justify-between">
                                                        <div className="flex items-center">
                                                            <img
                                                                src={item.image}
                                                                alt={item.name}
                                                                className="w-10 h-10 object-contain mr-3 border rounded"
                                                            />
                                                            <div>
                                                                <p className="font-medium">{item.name}</p>
                                                                <p className="text-sm text-gray-500">Qty: {item.qty}</p>
                                                            </div>
                                                        </div>
                                                        <p className="font-bold">₹{(item.price * item.qty).toFixed(2)}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="flex justify-end mt-4 pt-4 border-t">
                                            <button
                                                onClick={() => setSelectedOrder(order)}
                                                className="text-amazon-blue hover:text-amazon-dark font-medium"
                                            >
                                                <i className="fa-solid fa-file-invoice mr-2"></i>
                                                View Invoice
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- ACCOUNT PROFILE ---
        const AccountProfileView = ({ user, setView, logout, showToast, get, post }) => {
            const [userData, setUserData] = useState(user);
            const [activeTab, setActiveTab] = useState('profile');
            const [isEditing, setIsEditing] = useState(false);
            const [editForm, setEditForm] = useState({ ...user });
            const [orders, setOrders] = useState([]);
            const [recentActivity, setRecentActivity] = useState([]);

            useEffect(() => {
                const fetchUserData = async () => {
                    const data = await get({ action: 'getUserData', email: user.email });
                    if (data) setUserData(data);
                };
                fetchUserData();
            }, [user.email, get]);

            const tabs = [
                { id: 'profile', label: 'Profile', icon: 'fa-user' },
                { id: 'orders', label: 'Orders', icon: 'fa-shopping-bag' },
                { id: 'addresses', label: 'Addresses', icon: 'fa-map-marker-alt' },
                { id: 'coins', label: 'Reward Coins', icon: 'fa-coins' },
                { id: 'wishlist', label: 'Wishlist', icon: 'fa-heart' },
                { id: 'settings', label: 'Settings', icon: 'fa-cog' }
            ];

            const handleUpdateProfile = async () => {
                const res = await post({
                    action: 'updateProfile',
                    email: user.email,
                    ...editForm
                });
                if (res.status === 'success') {
                    setUserData(editForm);
                    setIsEditing(false);
                    showToast('Profile updated successfully', 'success');
                }
            };

            return (
                <div className="max-w-screen-xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <div className="flex items-center justify-between mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-amazon-dark">My Account</h2>
                        <div className="flex items-center space-x-3">
                            <button
                                onClick={() => setView('home')}
                                className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
                            >
                                <i className="fa-solid fa-home mr-2"></i>
                                Home
                            </button>
                            <button
                                onClick={logout}
                                className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                            >
                                <i className="fa-solid fa-sign-out-alt mr-2"></i>
                                Logout
                            </button>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        {/* Sidebar */}
                        <div className="lg:col-span-1">
                            <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                {/* User Info Card */}
                                <div className="p-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                                    <div className="flex items-center mb-4">
                                        <div className="w-16 h-16 bg-white rounded-full flex items-center justify-center text-blue-500 text-2xl font-bold">
                                            {user.name.charAt(0)}
                                        </div>
                                        <div className="ml-4">
                                            <h3 className="font-bold text-xl">{user.name}</h3>
                                            <p className="text-sm opacity-90">{user.email}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-sm">Member Since</p>
                                            <p className="font-bold">2024</p>
                                        </div>
                                        <div>
                                            <p className="text-sm">Reward Coins</p>
                                            <p className="font-bold">{userData.coins || 0}</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Navigation */}
                                <div className="p-4">
                                    {tabs.map(tab => (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`w-full flex items-center px-4 py-3 rounded-lg mb-2 transition ${
                                                activeTab === tab.id
                                                    ? 'bg-amazon-yellow text-amazon-dark font-bold'
                                                    : 'hover:bg-gray-100 text-gray-700'
                                            }`}
                                        >
                                            <i className={`fa-solid ${tab.icon} mr-3`}></i>
                                            {tab.label}
                                            {tab.id === 'orders' && orders.length > 0 && (
                                                <span className="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">
                                                    {orders.length}
                                                </span>
                                            )}
                                        </button>
                                    ))}
                                </div>

                                {/* Quick Stats */}
                                <div className="p-4 border-t">
                                    <h4 className="font-bold mb-3">Quick Stats</h4>
                                    <div className="space-y-2">
                                        <div className="flex justify-between">
                                            <span className="text-sm text-gray-600">Total Orders</span>
                                            <span className="font-bold">12</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-sm text-gray-600">Amount Spent</span>
                                            <span className="font-bold">₹8,450</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-sm text-gray-600">Coins Earned</span>
                                            <span className="font-bold text-yellow-600">845</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Main Content */}
                        <div className="lg:col-span-3">
                            {/* Profile Tab */}
                            {activeTab === 'profile' && (
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="text-xl font-bold">Profile Information</h3>
                                        <button
                                            onClick={() => setIsEditing(!isEditing)}
                                            className="px-4 py-2 bg-amazon-yellow text-amazon-dark rounded-lg hover:bg-amazon-orange"
                                        >
                                            <i className={`fa-solid ${isEditing ? 'fa-times' : 'fa-edit'} mr-2`}></i>
                                            {isEditing ? 'Cancel' : 'Edit Profile'}
                                        </button>
                                    </div>

                                    {isEditing ? (
                                        <div className="space-y-4">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Full Name</label>
                                                    <input
                                                        type="text"
                                                        value={editForm.name}
                                                        onChange={e => setEditForm({...editForm, name: e.target.value})}
                                                        className="w-full border rounded-lg px-4 py-2"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Email</label>
                                                    <input
                                                        type="email"
                                                        value={editForm.email}
                                                        className="w-full border rounded-lg px-4 py-2 bg-gray-50"
                                                        disabled
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Phone</label>
                                                    <input
                                                        type="tel"
                                                        value={editForm.phone}
                                                        onChange={e => setEditForm({...editForm, phone: e.target.value})}
                                                        className="w-full border rounded-lg px-4 py-2"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Date of Birth</label>
                                                    <input
                                                        type="date"
                                                        className="w-full border rounded-lg px-4 py-2"
                                                    />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Address</label>
                                                <textarea
                                                    className="w-full border rounded-lg px-4 py-2 h-32"
                                                    placeholder="Enter your address"
                                                ></textarea>
                                            </div>
                                            <div className="flex justify-end space-x-3">
                                                <button
                                                    onClick={() => setIsEditing(false)}
                                                    className="px-4 py-2 border rounded-lg hover:bg-gray-50"
                                                >
                                                    Cancel
                                                </button>
                                                <button
                                                    onClick={handleUpdateProfile}
                                                    className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                                                >
                                                    Save Changes
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-6">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <p className="text-sm text-gray-500">Full Name</p>
                                                    <p className="font-bold">{userData.name}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Email Address</p>
                                                    <p className="font-bold">{userData.email}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Phone Number</p>
                                                    <p className="font-bold">{userData.phone || 'Not provided'}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Account Type</p>
                                                    <p className="font-bold capitalize">{userData.role}</p>
                                                </div>
                                            </div>
                                            <div>
                                                <p className="text-sm text-gray-500">Default Shipping Address</p>
                                                <p className="font-bold">123 Main Street, Chennai, Tamil Nadu 600001</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Other tabs would be implemented similarly */}
                            {activeTab !== 'profile' && (
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-xl font-bold mb-4">
                                        {tabs.find(t => t.id === activeTab)?.label}
                                    </h3>
                                    <p className="text-gray-500">This section is under development.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        //  ADMIN PANEL COMPONENTS
        // ==========================================

        // --- ADMIN DASHBOARD ---
        const AdminDashboard = ({ showToast, setSelectedOrder, user }) => {
            const { get, post } = useApi();
            const [stats, setStats] = useState({
                totalUsers: 0,
                totalOrders: 0,
                totalProducts: 0,
                totalRevenue: 0,
                pendingOrders: 0,
                activeOffers: 0,
                todaySales: 0,
                monthlyGrowth: 0
            });
            const [recentOrders, setRecentOrders] = useState([]);
            const [topProducts, setTopProducts] = useState([]);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const fetchDashboardData = async () => {
                    setIsLoading(true);
                    // Fetch all data
                    const [users, orders, products] = await Promise.all([
                        get({ action: 'getUsers' }),
                        get({ action: 'getAllOrders' }),
                        get({ action: 'getProducts' })
                    ]);

                    // Calculate stats
                    const totalRevenue = orders
                        .filter(o => o.status === 'Delivered')
                        .reduce((sum, order) => sum + parseFloat(order.total || 0), 0);

                    const pendingOrders = orders.filter(o => o.status === 'Pending').length;
                    const today = new Date().toISOString().split('T')[0];
                    const todaySales = orders
                        .filter(o => o.date.includes(today))
                        .reduce((sum, order) => sum + parseFloat(order.total || 0), 0);

                    setStats({
                        totalUsers: users.length,
                        totalOrders: orders.length,
                        totalProducts: products.length,
                        totalRevenue,
                        pendingOrders,
                        activeOffers: 5, // Hardcoded for now
                        todaySales,
                        monthlyGrowth: 15.5 // Hardcoded
                    });

                    // Recent orders
                    setRecentOrders(orders.slice(0, 5));

                    // Top products (simulated)
                    setTopProducts(products.slice(0, 5).map(p => ({
                        ...p,
                        sales: Math.floor(Math.random() * 100) + 20
                    })));

                    setIsLoading(false);
                };

                fetchDashboardData();
            }, [get]);

            const statsCards = [
                {
                    title: 'Total Revenue',
                    value: `₹${stats.totalRevenue.toFixed(2)}`,
                    icon: 'fa-rupee-sign',
                    color: 'green',
                    change: `+${stats.monthlyGrowth}%`,
                    subtitle: 'From all orders'
                },
                {
                    title: 'Total Orders',
                    value: stats.totalOrders.toString(),
                    icon: 'fa-shopping-cart',
                    color: 'blue',
                    change: '+12%',
                    subtitle: 'Including pending'
                },
                {
                    title: 'Total Users',
                    value: stats.totalUsers.toString(),
                    icon: 'fa-users',
                    color: 'purple',
                    change: '+5%',
                    subtitle: 'Registered customers'
                },
                {
                    title: 'Pending Orders',
                    value: stats.pendingOrders.toString(),
                    icon: 'fa-clock',
                    color: 'yellow',
                    change: '-2%',
                    subtitle: 'Need attention'
                },
                {
                    title: 'Today\'s Sales',
                    value: `₹${stats.todaySales.toFixed(2)}`,
                    icon: 'fa-chart-line',
                    color: 'green',
                    change: '+18%',
                    subtitle: 'Revenue today'
                },
                {
                    title: 'Active Offers',
                    value: stats.activeOffers.toString(),
                    icon: 'fa-tags',
                    color: 'red',
                    change: '+3',
                    subtitle: 'Running promotions'
                }
            ];

            return (
                <div className="max-w-screen-2xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-amazon-dark">Admin Dashboard</h2>
                        <div className="text-sm text-gray-500">
                            Welcome back, {user?.name}
                        </div>
                    </div>

                    {isLoading ? (
                        <ShimmerLoader count={6} />
                    ) : (
                        <>
                            {/* Stats Grid */}
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
                                {statsCards.map((stat, index) => (
                                    <StatsCard key={index} {...stat} />
                                ))}
                            </div>

                            {/* Charts and Tables */}
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                {/* Recent Orders */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-bold">Recent Orders</h3>
                                        <button
                                            onClick={() => showToast('View all orders', 'info')}
                                            className="text-amazon-blue text-sm hover:underline"
                                        >
                                            View All
                                        </button>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead>
                                                <tr className="border-b">
                                                    <th className="text-left py-2 text-sm font-medium text-gray-500">Order ID</th>
                                                    <th className="text-left py-2 text-sm font-medium text-gray-500">Customer</th>
                                                    <th className="text-left py-2 text-sm font-medium text-gray-500">Amount</th>
                                                    <th className="text-left py-2 text-sm font-medium text-gray-500">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {recentOrders.map(order => (
                                                    <tr key={order.orderId} className="border-b hover:bg-gray-50">
                                                        <td className="py-3">
                                                            <button
                                                                onClick={() => setSelectedOrder(order)}
                                                                className="text-amazon-blue hover:underline text-sm"
                                                            >
                                                                #{order.orderId.slice(-6)}
                                                            </button>
                                                        </td>
                                                        <td className="py-3 text-sm">{order.userEmail}</td>
                                                        <td className="py-3 font-medium">₹{parseFloat(order.total).toFixed(2)}</td>
                                                        <td className="py-3">
                                                            <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(order.status)}`}>
                                                                {order.status}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Top Products */}
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-lg font-bold mb-4">Top Selling Products</h3>
                                    <div className="space-y-4">
                                        {topProducts.map(product => (
                                            <div key={product.id} className="flex items-center">
                                                <img
                                                    src={product.image}
                                                    alt={product.name}
                                                    className="w-12 h-12 object-contain border rounded-lg mr-3"
                                                />
                                                <div className="flex-grow">
                                                    <p className="font-medium">{product.name}</p>
                                                    <div className="flex items-center text-sm text-gray-500">
                                                        <span>{product.sales} sold</span>
                                                        <span className="mx-2">•</span>
                                                        <span>₹{product.price}</span>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-green-600 font-bold">
                                                        ₹{(product.sales * product.price).toFixed(2)}
                                                    </div>
                                                    <div className="text-xs text-gray-500">Revenue</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Quick Actions */}
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-lg font-bold mb-4">Quick Actions</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <button
                                        onClick={() => showToast('Add new product', 'info')}
                                        className="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-amazon-yellow hover:bg-yellow-50 text-center"
                                    >
                                        <i className="fa-solid fa-plus text-2xl text-gray-400 mb-2"></i>
                                        <p className="text-sm font-medium">Add Product</p>
                                    </button>
                                    <button
                                        onClick={() => showToast('Create offer', 'info')}
                                        className="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-amazon-yellow hover:bg-yellow-50 text-center"
                                    >
                                        <i className="fa-solid fa-tag text-2xl text-gray-400 mb-2"></i>
                                        <p className="text-sm font-medium">Create Offer</p>
                                    </button>
                                    <button
                                        onClick={() => showToast('View users', 'info')}
                                        className="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-amazon-yellow hover:bg-yellow-50 text-center"
                                    >
                                        <i className="fa-solid fa-users text-2xl text-gray-400 mb-2"></i>
                                        <p className="text-sm font-medium">Manage Users</p>
                                    </button>
                                    <button
                                        onClick={() => showToast('Generate report', 'info')}
                                        className="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-amazon-yellow hover:bg-yellow-50 text-center"
                                    >
                                        <i className="fa-solid fa-chart-pie text-2xl text-gray-400 mb-2"></i>
                                        <p className="text-sm font-medium">Reports</p>
                                    </button>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        };

        // --- ADMIN USER MANAGEMENT ---
        const AdminUserManagement = ({ showToast }) => {
            const { get, post } = useApi();
            const [users, setUsers] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [search, setSearch] = useState('');
            const [selectedUsers, setSelectedUsers] = useState([]);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [userToDelete, setUserToDelete] = useState(null);

            useEffect(() => {
                fetchUsers();
            }, []);

            const fetchUsers = async () => {
                setIsLoading(true);
                const data = await get({ action: 'getUsers' });
                setUsers(data);
                setIsLoading(false);
            };

            const filteredUsers = users.filter(user =>
                user.name.toLowerCase().includes(search.toLowerCase()) ||
                user.email.toLowerCase().includes(search.toLowerCase()) ||
                user.phone.includes(search)
            );

            const handleDeleteUser = async (email) => {
                const res = await post({ action: 'deleteUser', email });
                if (res.status === 'success') {
                    showToast(`User ${email} deleted successfully`, 'success');
                    fetchUsers();
                }
            };

            const handleResetPassword = async (email) => {
                const newPassword = prompt('Enter new password for ' + email);
                if (newPassword && newPassword.length >= 6) {
                    const res = await post({ action: 'resetPassword', email, newPassword });
                    if (res.status === 'success') {
                        showToast(`Password reset for ${email}`, 'success');
                    }
                }
            };

            const columns = [
                {
                    key: 'select',
                    header: '',
                    render: (_, user) => (
                        <input
                            type="checkbox"
                            checked={selectedUsers.includes(user.email)}
                            onChange={(e) => {
                                if (e.target.checked) {
                                    setSelectedUsers([...selectedUsers, user.email]);
                                } else {
                                    setSelectedUsers(selectedUsers.filter(email => email !== user.email));
                                }
                            }}
                        />
                    )
                },
                {
                    key: 'name',
                    header: 'Name',
                    render: (value, user) => (
                        <div className="flex items-center">
                            <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white mr-3">
                                {value.charAt(0)}
                            </div>
                            <div>
                                <p className="font-medium">{value}</p>
                                <p className="text-sm text-gray-500">{user.email}</p>
                            </div>
                        </div>
                    )
                },
                {
                    key: 'role',
                    header: 'Role',
                    render: (value) => (
                        <span className={`px-2 py-1 rounded-full text-xs ${
                            value === 'admin' ? 'bg-red-100 text-red-800' :
                            value === 'customer' ? 'bg-green-100 text-green-800' :
                            'bg-gray-100 text-gray-800'
                        }`}>
                            {value}
                        </span>
                    )
                },
                {
                    key: 'phone',
                    header: 'Phone'
                },
                {
                    key: 'coins',
                    header: 'Coins',
                    render: (value) => (
                        <span className="font-bold text-yellow-600">{value}</span>
                    )
                },
                {
                    key: 'lastLogin',
                    header: 'Last Login'
                }
            ];

            const actions = [
                {
                    icon: 'fa-key',
                    label: 'Reset Password',
                    className: 'text-blue-600 hover:text-blue-800',
                    onClick: (user) => handleResetPassword(user.email)
                },
                {
                    icon: 'fa-trash',
                    label: 'Delete',
                    className: 'text-red-600 hover:text-red-800',
                    onClick: (user) => {
                        setUserToDelete(user);
                        setShowDeleteModal(true);
                    }
                }
            ];

            return (
                <div className="max-w-screen-2xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-amazon-dark">User Management</h2>
                        <div className="flex items-center space-x-3">
                            <button
                                onClick={() => showToast('Export users', 'info')}
                                className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
                            >
                                <i className="fa-solid fa-download mr-2"></i>
                                Export
                            </button>
                            <button
                                onClick={() => showToast('Bulk action', 'info')}
                                className="px-4 py-2 bg-amazon-yellow text-amazon-dark rounded-lg hover:bg-amazon-orange"
                            >
                                <i className="fa-solid fa-user-plus mr-2"></i>
                                Add User
                            </button>
                        </div>
                    </div>

                    {/* Filters */}
                    <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                        <div className="flex flex-col md:flex-row gap-4">
                            <SearchBar
                                value={search}
                                onChange={setSearch}
                                placeholder="Search users by name, email, or phone..."
                                className="flex-grow"
                            />
                            <FilterSelect
                                value=""
                                onChange={() => {}}
                                options={[
                                    { value: '', label: 'All Roles' },
                                    { value: 'admin', label: 'Admin' },
                                    { value: 'customer', label: 'Customer' }
                                ]}
                            />
                        </div>
                        {selectedUsers.length > 0 && (
                            <div className="mt-4 p-3 bg-blue-50 rounded-lg flex items-center justify-between">
                                <span>{selectedUsers.length} users selected</span>
                                <div className="space-x-2">
                                    <button
                                        onClick={() => setSelectedUsers([])}
                                        className="text-sm text-gray-600 hover:text-gray-800"
                                    >
                                        Clear Selection
                                    </button>
                                    <button
                                        onClick={() => showToast('Bulk action coming soon', 'info')}
                                        className="text-sm text-red-600 hover:text-red-800"
                                    >
                                        Delete Selected
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Users Table */}
                    <DataTable
                        columns={columns}
                        data={filteredUsers}
                        isLoading={isLoading}
                        actions={actions}
                        emptyMessage="No users found"
                    />

                    {/* Delete Confirmation Modal */}
                    <ConfirmationModal
                        isOpen={showDeleteModal}
                        onClose={() => setShowDeleteModal(false)}
                        onConfirm={() => {
                            if (userToDelete) {
                                handleDeleteUser(userToDelete.email);
                                setUserToDelete(null);
                            }
                        }}
                        title="Delete User"
                        message={`Are you sure you want to delete ${userToDelete?.name}? This action cannot be undone.`}
                        confirmText="Delete User"
                        cancelText="Cancel"
                        type="danger"
                    />
                </div>
            );
        };

        // --- ADMIN PRODUCT MANAGEMENT ---
        const AdminProductManagement = ({ showToast }) => {
            const { get, post } = useApi();
            const [products, setProducts] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [showProductModal, setShowProductModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [categories, setCategories] = useState([]);
            const [search, setSearch] = useState('');
            const [filterCategory, setFilterCategory] = useState('');

            useEffect(() => {
                fetchProducts();
                fetchCategories();
            }, []);

            const fetchProducts = async () => {
                setIsLoading(true);
                const data = await get({ action: 'getProducts' });
                setProducts(data.map(p => ({
                    ...p,
                    price: parseFloat(p.price),
                    stock: parseInt(p.stock || 0)
                })));
                setIsLoading(false);
            };

            const fetchCategories = async () => {
                const cats = ['All', 'Groceries', 'Electronics', 'Fashion', 'Home', 'Beauty', 'Sports'];
                setCategories(cats);
            };

            const handleSaveProduct = async (productData) => {
                const res = await post({
                    action: editingProduct ? 'updateProduct' : 'addProduct',
                    ...productData
                });
                if (res.status === 'success') {
                    showToast(`Product ${editingProduct ? 'updated' : 'added'} successfully`, 'success');
                    setShowProductModal(false);
                    setEditingProduct(null);
                    fetchProducts();
                }
            };

            const handleDeleteProduct = async (id) => {
                if (!window.confirm('Delete this product?')) return;
                const res = await post({ action: 'deleteProduct', id });
                if (res.status === 'success') {
                    showToast('Product deleted', 'success');
                    fetchProducts();
                }
            };

            const filteredProducts = products.filter(p => {
                const matchesSearch = search === '' ||
                    p.name.toLowerCase().includes(search.toLowerCase()) ||
                    p.description.toLowerCase().includes(search.toLowerCase());
                const matchesCategory = filterCategory === '' || filterCategory === 'All' || p.category === filterCategory;
                return matchesSearch && matchesCategory;
            });

            return (
                <div className="max-w-screen-2xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-amazon-dark">Product Management</h2>
                        <button
                            onClick={() => {
                                setEditingProduct(null);
                                setShowProductModal(true);
                            }}
                            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                        >
                            <i className="fa-solid fa-plus mr-2"></i>
                            Add Product
                        </button>
                    </div>

                    {/* Filters */}
                    <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                        <div className="flex flex-col md:flex-row gap-4">
                            <SearchBar
                                value={search}
                                onChange={setSearch}
                                placeholder="Search products..."
                                className="flex-grow"
                            />
                            <FilterSelect
                                value={filterCategory}
                                onChange={setFilterCategory}
                                options={categories.map(cat => ({ value: cat, label: cat }))}
                            />
                            <select className="border rounded-lg px-3 py-2">
                                <option>Sort by: Newest</option>
                                <option>Sort by: Price Low-High</option>
                                <option>Sort by: Price High-Low</option>
                            </select>
                        </div>
                    </div>

                    {/* Products Grid */}
                    {isLoading ? (
                        <ShimmerLoader count={8} />
                    ) : (
                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                            {filteredProducts.map(product => (
                                <div key={product.id} className="bg-white rounded-lg shadow border p-4">
                                    <img
                                        src={product.image}
                                        alt={product.name}
                                        className="w-full h-40 object-contain mb-3"
                                    />
                                    <h3 className="font-bold text-sm mb-1 line-clamp-2">{product.name}</h3>
                                    <p className="text-xs text-gray-500 mb-2">{product.category}</p>
                                    <div className="flex justify-between items-center mb-3">
                                        <span className="font-bold text-red-600">₹{product.price}</span>
                                        <span className={`text-xs px-2 py-1 rounded ${
                                            product.stock > 20 ? 'bg-green-100 text-green-800' :
                                            product.stock > 0 ? 'bg-yellow-100 text-yellow-800' :
                                            'bg-red-100 text-red-800'
                                        }`}>
                                            Stock: {product.stock}
                                        </span>
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => {
                                                setEditingProduct(product);
                                                setShowProductModal(true);
                                            }}
                                            className="flex-grow bg-blue-500 text-white py-1 rounded text-sm hover:bg-blue-600"
                                        >
                                            Edit
                                        </button>
                                        <button
                                            onClick={() => handleDeleteProduct(product.id)}
                                            className="bg-red-500 text-white py-1 px-3 rounded text-sm hover:bg-red-600"
                                        >
                                            <i className="fa-solid fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Product Modal */}
                    {showProductModal && (
                        <ProductModal
                            product={editingProduct}
                            onClose={() => {
                                setShowProductModal(false);
                                setEditingProduct(null);
                            }}
                            onSave={handleSaveProduct}
                            categories={categories}
                        />
                    )}
                </div>
            );
        };

        // --- PRODUCT MODAL ---
        const ProductModal = ({ product, onClose, onSave, categories }) => {
            const [form, setForm] = useState({
                id: product?.id || '',
                name: product?.name || '',
                category: product?.category || categories[1] || '',
                price: product?.price || '',
                image: product?.image || '',
                description: product?.description || '',
                stock: product?.stock || 0,
                discount: product?.discount || 0
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(form);
            };

            return (
                <Modal
                    isOpen={true}
                    onClose={onClose}
                    title={product ? 'Edit Product' : 'Add New Product'}
                    size="lg"
                >
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Product Name *</label>
                                <input
                                    type="text"
                                    required
                                    value={form.name}
                                    onChange={e => setForm({...form, name: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Category *</label>
                                <select
                                    required
                                    value={form.category}
                                    onChange={e => setForm({...form, category: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                >
                                    {categories.filter(c => c !== 'All').map(cat => (
                                        <option key={cat} value={cat}>{cat}</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Price (₹) *</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    required
                                    value={form.price}
                                    onChange={e => setForm({...form, price: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Stock Quantity *</label>
                                <input
                                    type="number"
                                    required
                                    value={form.stock}
                                    onChange={e => setForm({...form, stock: parseInt(e.target.value)})}
                                    className="w-full border rounded-lg px-4 py-2"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Discount (%)</label>
                                <input
                                    type="number"
                                    min="0"
                                    max="100"
                                    value={form.discount}
                                    onChange={e => setForm({...form, discount: parseInt(e.target.value)})}
                                    className="w-full border rounded-lg px-4 py-2"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Product ID</label>
                                <input
                                    type="text"
                                    value={form.id}
                                    onChange={e => setForm({...form, id: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2 bg-gray-50"
                                    placeholder="Auto-generated"
                                    readOnly={!!product}
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-medium mb-2">Image URL</label>
                            <input
                                type="url"
                                value={form.image}
                                onChange={e => setForm({...form, image: e.target.value})}
                                className="w-full border rounded-lg px-4 py-2"
                                placeholder="https://example.com/image.jpg"
                            />
                        </div>

                        <div>
                            <label className="block text-sm font-medium mb-2">Description</label>
                            <textarea
                                value={form.description}
                                onChange={e => setForm({...form, description: e.target.value})}
                                className="w-full border rounded-lg px-4 py-2 h-32"
                                placeholder="Product description..."
                            />
                        </div>

                        <div className="flex justify-end space-x-3 pt-4 border-t">
                            <button
                                type="button"
                                onClick={onClose}
                                className="px-4 py-2 border rounded-lg hover:bg-gray-50"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                            >
                                {product ? 'Update Product' : 'Add Product'}
                            </button>
                        </div>
                    </form>
                </Modal>
            );
        };

        // --- ADMIN ORDER MANAGEMENT ---
        const AdminOrderManagement = ({ showToast, setSelectedOrder }) => {
            const { get, post } = useApi();
            const [orders, setOrders] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [search, setSearch] = useState('');
            const [statusFilter, setStatusFilter] = useState('all');
            const [dateRange, setDateRange] = useState('today');

            useEffect(() => {
                fetchOrders();
            }, [dateRange]);

            const fetchOrders = async () => {
                setIsLoading(true);
                const data = await get({ action: 'getAllOrders' });
                setOrders(data.sort((a, b) => new Date(b.date) - new Date(a.date)));
                setIsLoading(false);
            };

            const handleUpdateStatus = async (orderId, newStatus) => {
                const res = await post({ action: 'updateOrderStatus', orderId, status: newStatus });
                if (res.status === 'success') {
                    showToast(`Order ${orderId} status updated to ${newStatus}`, 'success');
                    fetchOrders();
                }
            };

            const filteredOrders = orders.filter(order => {
                const matchesSearch = search === '' ||
                    order.orderId.toLowerCase().includes(search.toLowerCase()) ||
                    order.userEmail.toLowerCase().includes(search.toLowerCase());
                const matchesStatus = statusFilter === 'all' || order.status === statusFilter;
                return matchesSearch && matchesStatus;
            });

            const columns = [
                {
                    key: 'orderId',
                    header: 'Order ID',
                    render: (value) => (
                        <button
                            onClick={() => setSelectedOrder(orders.find(o => o.orderId === value))}
                            className="text-amazon-blue hover:underline"
                        >
                            #{value.slice(-6)}
                        </button>
                    )
                },
                {
                    key: 'userEmail',
                    header: 'Customer',
                    render: (value) => (
                        <div>
                            <p className="font-medium">{value}</p>
                            <p className="text-xs text-gray-500">
                                {orders.find(o => o.userEmail === value)?.address?.split(',')[0]}
                            </p>
                        </div>
                    )
                },
                {
                    key: 'date',
                    header: 'Date',
                    render: (value) => new Date(value).toLocaleDateString()
                },
                {
                    key: 'total',
                    header: 'Amount',
                    render: (value) => `₹${parseFloat(value).toFixed(2)}`
                },
                {
                    key: 'status',
                    header: 'Status',
                    render: (value, order) => (
                        <div className="flex items-center space-x-2">
                            <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(value)}`}>
                                {value}
                            </span>
                            <select
                                value={value}
                                onChange={(e) => handleUpdateStatus(order.orderId, e.target.value)}
                                className="text-xs border rounded px-2 py-1"
                            >
                                <option value="Pending">Pending</option>
                                <option value="Confirmed">Confirmed</option>
                                <option value="Shipped">Shipped</option>
                                <option value="Delivered">Delivered</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                    )
                }
            ];

            const actions = [
                {
                    icon: 'fa-eye',
                    label: 'View',
                    className: 'text-blue-600 hover:text-blue-800',
                    onClick: (order) => setSelectedOrder(order)
                },
                {
                    icon: 'fa-print',
                    label: 'Print',
                    className: 'text-gray-600 hover:text-gray-800',
                    onClick: (order) => window.print()
                }
            ];

            return (
                <div className="max-w-screen-2xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-amazon-dark">Order Management</h2>
                        <div className="flex items-center space-x-3">
                            <FilterSelect
                                value={dateRange}
                                onChange={setDateRange}
                                options={[
                                    { value: 'today', label: 'Today' },
                                    { value: 'week', label: 'This Week' },
                                    { value: 'month', label: 'This Month' },
                                    { value: 'all', label: 'All Time' }
                                ]}
                            />
                            <button
                                onClick={() => showToast('Export orders', 'info')}
                                className="px-4 py-2 bg-amazon-yellow text-amazon-dark rounded-lg hover:bg-amazon-orange"
                            >
                                <i className="fa-solid fa-download mr-2"></i>
                                Export Orders
                            </button>
                        </div>
                    </div>

                    {/* Filters */}
                    <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                        <div className="flex flex-col md:flex-row gap-4">
                            <SearchBar
                                value={search}
                                onChange={setSearch}
                                placeholder="Search orders by ID or customer..."
                                className="flex-grow"
                            />
                            <FilterSelect
                                value={statusFilter}
                                onChange={setStatusFilter}
                                options={[
                                    { value: 'all', label: 'All Status' },
                                    { value: 'Pending', label: 'Pending' },
                                    { value: 'Confirmed', label: 'Confirmed' },
                                    { value: 'Shipped', label: 'Shipped' },
                                    { value: 'Delivered', label: 'Delivered' },
                                    { value: 'Cancelled', label: 'Cancelled' }
                                ]}
                            />
                        </div>
                    </div>

                    {/* Orders Table */}
                    <DataTable
                        columns={columns}
                        data={filteredOrders}
                        isLoading={isLoading}
                        actions={actions}
                        emptyMessage="No orders found"
                    />

                    {/* Order Stats */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                        <div className="bg-white p-4 rounded-lg shadow">
                            <p className="text-sm text-gray-500">Total Orders</p>
                            <p className="text-2xl font-bold">{orders.length}</p>
                        </div>
                        <div className="bg-white p-4 rounded-lg shadow">
                            <p className="text-sm text-gray-500">Pending</p>
                            <p className="text-2xl font-bold text-yellow-600">
                                {orders.filter(o => o.status === 'Pending').length}
                            </p>
                        </div>
                        <div className="bg-white p-4 rounded-lg shadow">
                            <p className="text-sm text-gray-500">Delivered</p>
                            <p className="text-2xl font-bold text-green-600">
                                {orders.filter(o => o.status === 'Delivered').length}
                            </p>
                        </div>
                        <div className="bg-white p-4 rounded-lg shadow">
                            <p className="text-sm text-gray-500">Total Revenue</p>
                            <p className="text-2xl font-bold text-blue-600">
                                ₹{orders.reduce((sum, o) => sum + parseFloat(o.total || 0), 0).toFixed(2)}
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ADMIN OFFER MANAGEMENT ---
        const AdminOfferManagement = ({ showToast }) => {
            const [offers, setOffers] = useState([
                { id: 1, code: 'WELCOME20', title: 'Welcome Offer', type: 'percentage', value: 20,
                  minOrder: 0, maxDiscount: 500, startDate: '2024-01-01', endDate: '2024-12-31',
                  status: 'Active', usageLimit: 1000, usedCount: 245 },
                { id: 2, code: 'FLAT100', title: 'Flat Discount', type: 'fixed', value: 100,
                  minOrder: 500, maxDiscount: 100, startDate: '2024-01-01', endDate: '2024-12-31',
                  status: 'Active', usageLimit: 500, usedCount: 123 },
                { id: 3, code: 'FREESHIP', title: 'Free Shipping', type: 'shipping', value: 0,
                  minOrder: 999, maxDiscount: 0, startDate: '2024-01-01', endDate: '2024-12-31',
                  status: 'Active', usageLimit: 1000, usedCount: 456 },
                { id: 4, code: 'SAVE50', title: 'Weekend Special', type: 'percentage', value: 15,
                  minOrder: 1000, maxDiscount: 300, startDate: '2024-01-01', endDate: '2024-12-31',
                  status: 'Inactive', usageLimit: 200, usedCount: 89 }
            ]);

            const [showOfferModal, setShowOfferModal] = useState(false);
            const [editingOffer, setEditingOffer] = useState(null);
            const [search, setSearch] = useState('');
            const [statusFilter, setStatusFilter] = useState('all');

            const filteredOffers = offers.filter(offer => {
                const matchesSearch = search === '' ||
                    offer.code.toLowerCase().includes(search.toLowerCase()) ||
                    offer.title.toLowerCase().includes(search.toLowerCase());
                const matchesStatus = statusFilter === 'all' || offer.status === statusFilter;
                return matchesSearch && matchesStatus;
            });

            const handleSaveOffer = (offerData) => {
                if (editingOffer) {
                    setOffers(offers.map(o => o.id === offerData.id ? offerData : o));
                    showToast('Offer updated successfully', 'success');
                } else {
                    setOffers([...offers, { ...offerData, id: offers.length + 1 }]);
                    showToast('Offer created successfully', 'success');
                }
                setShowOfferModal(false);
                setEditingOffer(null);
            };

            const handleDeleteOffer = (id) => {
                if (window.confirm('Delete this offer?')) {
                    setOffers(offers.filter(o => o.id !== id));
                    showToast('Offer deleted', 'success');
                }
            };

            const handleToggleStatus = (id) => {
                setOffers(offers.map(o =>
                    o.id === id ? { ...o, status: o.status === 'Active' ? 'Inactive' : 'Active' } : o
                ));
            };

            return (
                <div className="max-w-screen-2xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-amazon-dark">Offer Management</h2>
                        <button
                            onClick={() => {
                                setEditingOffer(null);
                                setShowOfferModal(true);
                            }}
                            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                        >
                            <i className="fa-solid fa-plus mr-2"></i>
                            Create Offer
                        </button>
                    </div>

                    {/* Filters */}
                    <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                        <div className="flex flex-col md:flex-row gap-4">
                            <SearchBar
                                value={search}
                                onChange={setSearch}
                                placeholder="Search offers by code or title..."
                                className="flex-grow"
                            />
                            <FilterSelect
                                value={statusFilter}
                                onChange={setStatusFilter}
                                options={[
                                    { value: 'all', label: 'All Status' },
                                    { value: 'Active', label: 'Active' },
                                    { value: 'Inactive', label: 'Inactive' },
                                    { value: 'Expired', label: 'Expired' }
                                ]}
                            />
                        </div>
                    </div>

                    {/* Offers Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {filteredOffers.map(offer => (
                            <div key={offer.id} className="bg-white rounded-lg shadow border p-4">
                                <div className="flex justify-between items-start mb-3">
                                    <div>
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="font-bold text-lg">{offer.code}</span>
                                            <OfferBadge offer={offer} />
                                        </div>
                                        <h3 className="font-bold text-gray-800">{offer.title}</h3>
                                    </div>
                                    <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(offer.status)}`}>
                                        {offer.status}
                                    </span>
                                </div>

                                <div className="space-y-2 mb-4">
                                    <div className="flex justify-between text-sm">
                                        <span className="text-gray-500">Discount:</span>
                                        <span className="font-bold">
                                            {offer.type === 'percentage' ? `${offer.value}%` :
                                             offer.type === 'fixed' ? `₹${offer.value}` :
                                             'Free Shipping'}
                                            {offer.maxDiscount > 0 && offer.type === 'percentage' &&
                                             ` (Max ₹${offer.maxDiscount})`}
                                        </span>
                                    </div>
                                    <div className="flex justify-between text-sm">
                                        <span className="text-gray-500">Min Order:</span>
                                        <span>₹{offer.minOrder}</span>
                                    </div>
                                    <div className="flex justify-between text-sm">
                                        <span className="text-gray-500">Validity:</span>
                                        <span>{offer.endDate}</span>
                                    </div>
                                    <div className="flex justify-between text-sm">
                                        <span className="text-gray-500">Usage:</span>
                                        <span>{offer.usedCount}/{offer.usageLimit}</span>
                                    </div>
                                </div>

                                <div className="flex gap-2">
                                    <button
                                        onClick={() => {
                                            setEditingOffer(offer);
                                            setShowOfferModal(true);
                                        }}
                                        className="flex-grow bg-blue-500 text-white py-1 rounded text-sm hover:bg-blue-600"
                                    >
                                        Edit
                                    </button>
                                    <button
                                        onClick={() => handleToggleStatus(offer.id)}
                                        className={`px-3 py-1 rounded text-sm ${
                                            offer.status === 'Active'
                                            ? 'bg-yellow-500 text-white hover:bg-yellow-600'
                                            : 'bg-green-500 text-white hover:bg-green-600'
                                        }`}
                                    >
                                        {offer.status === 'Active' ? 'Deactivate' : 'Activate'}
                                    </button>
                                    <button
                                        onClick={() => handleDeleteOffer(offer.id)}
                                        className="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600"
                                    >
                                        <i className="fa-solid fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Offer Modal */}
                    {showOfferModal && (
                        <OfferModal
                            offer={editingOffer}
                            onClose={() => {
                                setShowOfferModal(false);
                                setEditingOffer(null);
                            }}
                            onSave={handleSaveOffer}
                        />
                    )}
                </div>
            );
        };

        // --- OFFER MODAL ---
        const OfferModal = ({ offer, onClose, onSave }) => {
            const [form, setForm] = useState({
                id: offer?.id || '',
                code: offer?.code || '',
                title: offer?.title || '',
                type: offer?.type || 'percentage',
                value: offer?.value || 0,
                minOrder: offer?.minOrder || 0,
                maxDiscount: offer?.maxDiscount || 0,
                startDate: offer?.startDate || new Date().toISOString().split('T')[0],
                endDate: offer?.endDate || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                status: offer?.status || 'Active',
                usageLimit: offer?.usageLimit || 1000,
                description: offer?.description || ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(form);
            };

            return (
                <Modal
                    isOpen={true}
                    onClose={onClose}
                    title={offer ? 'Edit Offer' : 'Create New Offer'}
                    size="lg"
                >
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Offer Code *</label>
                                <input
                                    type="text"
                                    required
                                    value={form.code}
                                    onChange={e => setForm({...form, code: e.target.value.toUpperCase()})}
                                    className="w-full border rounded-lg px-4 py-2"
                                    placeholder="WELCOME20"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Offer Title *</label>
                                <input
                                    type="text"
                                    required
                                    value={form.title}
                                    onChange={e => setForm({...form, title: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                    placeholder="Welcome Offer"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Offer Type *</label>
                                <select
                                    required
                                    value={form.type}
                                    onChange={e => setForm({...form, type: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                >
                                    <option value="percentage">Percentage Discount</option>
                                    <option value="fixed">Fixed Amount Discount</option>
                                    <option value="shipping">Free Shipping</option>
                                    <option value="bogo">Buy One Get One</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">
                                    {form.type === 'percentage' ? 'Discount Percentage' :
                                     form.type === 'fixed' ? 'Discount Amount (₹)' : 'Shipping Value'}
                                </label>
                                <input
                                    type="number"
                                    required
                                    value={form.value}
                                    onChange={e => setForm({...form, value: parseFloat(e.target.value)})}
                                    className="w-full border rounded-lg px-4 py-2"
                                    min="0"
                                    step={form.type === 'percentage' ? '0.1' : '1'}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Minimum Order (₹)</label>
                                <input
                                    type="number"
                                    value={form.minOrder}
                                    onChange={e => setForm({...form, minOrder: parseFloat(e.target.value)})}
                                    className="w-full border rounded-lg px-4 py-2"
                                    min="0"
                                />
                            </div>
                            {form.type === 'percentage' && (
                                <div>
                                    <label className="block text-sm font-medium mb-2">Maximum Discount (₹)</label>
                                    <input
                                        type="number"
                                        value={form.maxDiscount}
                                        onChange={e => setForm({...form, maxDiscount: parseFloat(e.target.value)})}
                                        className="w-full border rounded-lg px-4 py-2"
                                        min="0"
                                    />
                                </div>
                            )}
                            <div>
                                <label className="block text-sm font-medium mb-2">Start Date</label>
                                <input
                                    type="date"
                                    value={form.startDate}
                                    onChange={e => setForm({...form, startDate: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">End Date</label>
                                <input
                                    type="date"
                                    value={form.endDate}
                                    onChange={e => setForm({...form, endDate: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Usage Limit</label>
                                <input
                                    type="number"
                                    value={form.usageLimit}
                                    onChange={e => setForm({...form, usageLimit: parseInt(e.target.value)})}
                                    className="w-full border rounded-lg px-4 py-2"
                                    min="1"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Status</label>
                                <select
                                    value={form.status}
                                    onChange={e => setForm({...form, status: e.target.value})}
                                    className="w-full border rounded-lg px-4 py-2"
                                >
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                    <option value="Expired">Expired</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-medium mb-2">Description</label>
                            <textarea
                                value={form.description}
                                onChange={e => setForm({...form, description: e.target.value})}
                                className="w-full border rounded-lg px-4 py-2 h-24"
                                placeholder="Offer description..."
                            />
                        </div>

                        <div className="flex justify-end space-x-3 pt-4 border-t">
                            <button
                                type="button"
                                onClick={onClose}
                                className="px-4 py-2 border rounded-lg hover:bg-gray-50"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                            >
                                {offer ? 'Update Offer' : 'Create Offer'}
                            </button>
                        </div>
                    </form>
                </Modal>
            );
        };

        // --- ADMIN ANALYTICS ---
        const AdminAnalytics = ({ showToast }) => {
            const [timeRange, setTimeRange] = useState('month');
            const [chartData, setChartData] = useState(null);
            const chartRef = useRef(null);

            useEffect(() => {
                // Generate sample chart data
                const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'];
                const salesData = [6500, 5900, 8000, 8100, 5600, 5500, 7500];
                const ordersData = [120, 110, 150, 145, 100, 95, 130];

                setChartData({
                    labels,
                    datasets: [
                        {
                            label: 'Sales (₹)',
                            data: salesData,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Orders',
                            data: ordersData,
                            borderColor: 'rgb(16, 185, 129)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }
                    ]
                });
            }, [timeRange]);

            useEffect(() => {
                if (chartRef.current && chartData) {
                    const ctx = chartRef.current.getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: chartData,
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'Sales & Orders Analytics'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }, [chartData]);

            return (
                <div className="max-w-screen-2xl mx-auto p-4 md:p-6 mt-6 pb-mobile-nav">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-amazon-dark">Analytics Dashboard</h2>
                        <div className="flex items-center space-x-3">
                            <FilterSelect
                                value={timeRange}
                                onChange={setTimeRange}
                                options={[
                                    { value: 'week', label: 'Last Week' },
                                    { value: 'month', label: 'Last Month' },
                                    { value: 'quarter', label: 'Last Quarter' },
                                    { value: 'year', label: 'Last Year' }
                                ]}
                            />
                            <button
                                onClick={() => showToast('Export report', 'info')}
                                className="px-4 py-2 bg-amazon-yellow text-amazon-dark rounded-lg hover:bg-amazon-orange"
                            >
                                <i className="fa-solid fa-download mr-2"></i>
                                Export Report
                            </button>
                        </div>
                    </div>

                    {/* Stats Overview */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <StatsCard
                            title="Total Revenue"
                            value="₹45,280"
                            icon="fa-rupee-sign"
                            color="green"
                            change="+12.5%"
                        />
                        <StatsCard
                            title="Total Orders"
                            value="1,248"
                            icon="fa-shopping-cart"
                            color="blue"
                            change="+8.2%"
                        />
                        <StatsCard
                            title="Average Order"
                            value="₹2,450"
                            icon="fa-chart-bar"
                            color="purple"
                            change="+5.1%"
                        />
                        <StatsCard
                            title="Conversion Rate"
                            value="3.8%"
                            icon="fa-percentage"
                            color="red"
                            change="+0.4%"
                        />
                    </div>

                    {/* Charts */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-bold mb-4">Sales & Orders Trend</h3>
                            <canvas ref={chartRef} height="300"></canvas>
                        </div>
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-bold mb-4">Category Performance</h3>
                            <div className="space-y-4">
                                {[
                                    { category: 'Groceries', sales: 12500, growth: '+15%' },
                                    { category: 'Electronics', sales: 8900, growth: '+22%' },
                                    { category: 'Fashion', sales: 7600, growth: '+8%' },
                                    { category: 'Home & Kitchen', sales: 5400, growth: '+12%' },
                                    { category: 'Beauty', sales: 3200, growth: '+18%' }
                                ].map((item, idx) => (
                                    <div key={idx} className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center mr-3">
                                                <i className="fa-solid fa-tag text-blue-600"></i>
                                            </div>
                                            <div>
                                                <p className="font-medium">{item.category}</p>
                                                <p className="text-sm text-gray-500">{item.growth}</p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <p className="font-bold">₹{item.sales.toLocaleString()}</p>
                                            <div className="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                                                <div
                                                    className="h-full bg-green-500 rounded-full"
                                                    style={{ width: `${(item.sales / 12500) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Additional Analytics */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-bold mb-4">Top Products</h3>
                            <div className="space-y-3">
                                {[
                                    { name: 'Basmati Rice', sales: 245, revenue: 12250 },
                                    { name: 'Sunflower Oil', sales: 189, revenue: 9450 },
                                    { name: 'Smartphone', sales: 56, revenue: 28000 },
                                    { name: 'Laptop', sales: 34, revenue: 51000 }
                                ].map((product, idx) => (
                                    <div key={idx} className="flex justify-between items-center">
                                        <div>
                                            <p className="font-medium">{product.name}</p>
                                            <p className="text-sm text-gray-500">{product.sales} sold</p>
                                        </div>
                                        <p className="font-bold text-green-600">₹{product.revenue}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-bold mb-4">Customer Insights</h3>
                            <div className="space-y-4">
                                <div className="flex justify-between">
                                    <span className="text-gray-600">New Customers</span>
                                    <span className="font-bold">45</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Repeat Customers</span>
                                    <span className="font-bold">62%</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Avg. Customer Value</span>
                                    <span className="font-bold">₹3,250</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-600">Customer Satisfaction</span>
                                    <span className="font-bold text-green-600">4.8/5</span>
                                </div>
                            </div>
                        </div>
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-lg font-bold mb-4">Quick Actions</h3>
                            <div className="space-y-3">
                                <button className="w-full text-left p-3 border rounded-lg hover:bg-gray-50">
                                    <i className="fa-solid fa-chart-line text-blue-500 mr-2"></i>
                                    Generate Monthly Report
                                </button>
                                <button className="w-full text-left p-3 border rounded-lg hover:bg-gray-50">
                                    <i className="fa-solid fa-bell text-yellow-500 mr-2"></i>
                                    Set Performance Alerts
                                </button>
                                <button className="w-full text-left p-3 border rounded-lg hover:bg-gray-50">
                                    <i className="fa-solid fa-cog text-gray-500 mr-2"></i>
                                    Configure Analytics
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ADMIN PANEL LAYOUT ---
        const AdminPanel = ({ showToast, setSelectedOrder, user }) => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [adminView, setAdminView] = useState('overview');

            const adminTabs = [
                { id: 'dashboard', label: 'Dashboard', icon: 'fa-chart-line' },
                { id: 'orders', label: 'Orders', icon: 'fa-shopping-cart' },
                { id: 'products', label: 'Products', icon: 'fa-box' },
                { id: 'users', label: 'Users', icon: 'fa-users' },
                { id: 'offers', label: 'Offers', icon: 'fa-tags' },
                { id: 'analytics', label: 'Analytics', icon: 'fa-chart-pie' },
                { id: 'settings', label: 'Settings', icon: 'fa-cog' }
            ];

            return (
                <div className="max-w-screen-2xl mx-auto mt-6 pb-mobile-nav">
                    {/* Admin Header */}
                    <div className="bg-amazon-dark text-white p-4 rounded-t-xl">
                        <div className="flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h2 className="text-2xl font-bold">Admin Panel</h2>
                                <p className="text-sm opacity-80">Welcome, {user?.name}</p>
                            </div>
                            <div className="flex items-center space-x-4 mt-4 md:mt-0">
                                <div className="text-sm">
                                    <span className="opacity-80">Last Login:</span>
                                    <span className="ml-2">{new Date().toLocaleString()}</span>
                                </div>
                                <button
                                    onClick={() => showToast('Admin notifications', 'info')}
                                    className="relative p-2 hover:bg-amazon-light rounded"
                                >
                                    <i className="fa-solid fa-bell"></i>
                                    <span className="absolute -top-1 -right-1 bg-red-500 text-xs w-5 h-5 rounded-full flex items-center justify-center">
                                        3
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Admin Navigation */}
                    <div className="bg-white shadow-lg">
                        <div className="flex overflow-x-auto">
                            {adminTabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center px-6 py-4 whitespace-nowrap transition ${
                                        activeTab === tab.id
                                            ? 'border-b-2 border-amazon-yellow text-amazon-dark font-bold'
                                            : 'text-gray-600 hover:text-amazon-dark'
                                    }`}
                                >
                                    <i className={`fa-solid ${tab.icon} mr-2`}></i>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Admin Content */}
                    <div className="bg-gray-50 min-h-screen p-4">
                        {activeTab === 'dashboard' && (
                            <AdminDashboard showToast={showToast} setSelectedOrder={setSelectedOrder} user={user} />
                        )}
                        {activeTab === 'orders' && (
                            <AdminOrderManagement showToast={showToast} setSelectedOrder={setSelectedOrder} />
                        )}
                        {activeTab === 'products' && (
                            <AdminProductManagement showToast={showToast} />
                        )}
                        {activeTab === 'users' && (
                            <AdminUserManagement showToast={showToast} />
                        )}
                        {activeTab === 'offers' && (
                            <AdminOfferManagement showToast={showToast} />
                        )}
                        {activeTab === 'analytics' && (
                            <AdminAnalytics showToast={showToast} />
                        )}
                        {activeTab === 'settings' && (
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-xl font-bold mb-4">Admin Settings</h3>
                                <p className="text-gray-500">Settings panel under development.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ==========================================
        //  INVOICE/BILL GENERATOR
        // ==========================================
        const BillGenerator = ({ order, onBack }) => {
            const printBill = () => {
                window.print();
            };

            const finalTotal = parseFloat(order.total);

            return (
                <div className="print-bill max-w-screen-md mx-auto p-4 md:p-6 mt-6">
                    <div className="bg-white p-6 md:p-8 rounded-lg shadow-2xl border border-gray-300">
                        {/* Header */}
                        <div className="flex justify-between items-center border-b-4 border-amazon-dark pb-4 mb-6">
                            <div>
                                <h1 className="text-3xl md:text-4xl font-extrabold text-amazon-dark">INVOICE</h1>
                                <p className="text-gray-600">Murugan Super Store</p>
                            </div>
                            <div className="text-right">
                                <h2 className="text-lg md:text-xl font-bold">Invoice #: {order.orderId}</h2>
                                <p className="text-sm text-gray-500">Date: {order.date}</p>
                            </div>
                        </div>

                        {/* Bill Info */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div>
                                <h3 className="font-bold text-gray-700 mb-2">BILL TO:</h3>
                                <p className="font-medium">{order.userEmail}</p>
                                <p className="text-sm text-gray-600">{order.address}</p>
                            </div>
                            <div>
                                <h3 className="font-bold text-gray-700 mb-2">INVOICE DETAILS:</h3>
                                <div className="space-y-1 text-sm">
                                    <div className="flex justify-between">
                                        <span>Invoice ID:</span>
                                        <span className="font-medium">{order.orderId}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Invoice Date:</span>
                                        <span>{order.date}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Status:</span>
                                        <span className={`px-2 py-1 rounded ${getStatusColor(order.status)}`}>
                                            {order.status}
                                        </span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Payment Method:</span>
                                        <span>{order.transactionId === 'COD' ? 'Cash on Delivery' : 'UPI'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Items Table */}
                        <div className="mb-8 overflow-x-auto">
                            <table className="w-full border-collapse">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-3 text-left font-semibold text-gray-700">Description</th>
                                        <th className="p-3 text-right font-semibold text-gray-700">Price</th>
                                        <th className="p-3 text-right font-semibold text-gray-700">Qty</th>
                                        <th className="p-3 text-right font-semibold text-gray-700">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {order.items.map((item, idx) => (
                                        <tr key={idx} className="border-b hover:bg-gray-50">
                                            <td className="p-3">{item.name}</td>
                                            <td className="p-3 text-right">₹{parseFloat(item.price).toFixed(2)}</td>
                                            <td className="p-3 text-right">{item.qty}</td>
                                            <td className="p-3 text-right font-medium">
                                                ₹{(parseFloat(item.price) * item.qty).toFixed(2)}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {/* Totals */}
                        <div className="border-t pt-6">
                            <div className="flex justify-end">
                                <div className="w-full md:w-1/2">
                                    <div className="space-y-2">
                                        <div className="flex justify-between">
                                            <span className="font-medium">Subtotal:</span>
                                            <span>₹{finalTotal.toFixed(2)}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="font-medium">Shipping:</span>
                                            <span className="text-green-600">FREE</span>
                                        </div>
                                        <div className="flex justify-between border-t pt-2 text-lg font-bold">
                                            <span>GRAND TOTAL:</span>
                                            <span className="text-red-600">₹{finalTotal.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="mt-10 pt-6 border-t text-center">
                            <p className="text-gray-500 mb-4">
                                Thank you for shopping with Murugan Super Store!
                            </p>
                            <div className="flex flex-wrap justify-center gap-3 print:hidden">
                                <button
                                    onClick={printBill}
                                    className="bg-blue-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-600 transition"
                                >
                                    <i className="fa-solid fa-print mr-2"></i> Print Invoice
                                </button>
                                <button
                                    onClick={onBack}
                                    className="bg-gray-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-gray-600 transition"
                                >
                                    <i className="fa-solid fa-arrow-left mr-2"></i> Back to Orders
                                </button>
                                <button
                                    onClick={() => window.location.href = `mailto:?subject=Invoice ${order.orderId}&body=Please find attached invoice for order ${order.orderId}`}
                                    className="bg-green-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-600 transition"
                                >
                                    <i className="fa-solid fa-envelope mr-2"></i> Email Invoice
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        //  MOBILE NAVIGATION
        // ==========================================
        const MobileNavBar = ({ view, setView, totalCartItems, user }) => {
            const navItems = [
                { name: 'Home', view: 'home', icon: 'fa-home', isCurrent: view === 'home' },
                { name: 'Categories', view: 'categories', icon: 'fa-th-large', isCurrent: view === 'categories' },
                { name: 'Offers', view: 'offers', icon: 'fa-tags', isCurrent: view === 'offers' },
                { name: 'Cart', view: 'cart', icon: 'fa-shopping-cart', isCurrent: view === 'cart', badge: totalCartItems },
                { name: 'Account', view: user ? 'account' : 'login', icon: user ? 'fa-user' : 'fa-sign-in-alt', isCurrent: view === 'account' || view === 'login' }
            ];

            return (
                <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 md:hidden shadow-2xl">
                    <div className="flex justify-around items-center h-16">
                        {navItems.map(item => (
                            <button
                                key={item.name}
                                onClick={() => setView(item.view)}
                                className={`flex flex-col items-center justify-center p-1 transition-colors relative ${
                                    item.isCurrent ? 'text-amazon-blue' : 'text-gray-500 hover:text-amazon-dark'
                                }`}
                            >
                                <i className={`fa-solid ${item.icon} text-xl`}></i>
                                <span className="text-xs mt-1 font-medium">{item.name}</span>
                                {item.badge > 0 && item.view === 'cart' && (
                                    <span className="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center badge-pulse">
                                        {item.badge}
                                    </span>
                                )}
                            </button>
                        ))}
                    </div>
                </nav>
            );
        };

        // ==========================================
        //  MAIN APP COMPONENT
        // ==========================================
        const App = () => {
            const [view, setView] = useState('home');
            const [user, setUser] = useState(() => {
                const savedUser = localStorage.getItem('muruganUser');
                return savedUser ? JSON.parse(savedUser) : null;
            });
            const [cart, setCart] = useState(() => {
                const savedCart = localStorage.getItem('muruganCart');
                return savedCart ? JSON.parse(savedCart) : [];
            });
            const [products, setProducts] = useState([]);
            const [offers, setOffers] = useState([]);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [selectedOrder, setSelectedOrder] = useState(null);
            const [address, setAddress] = useState('');
            const [city, setCity] = useState('');
            const [pincode, setPincode] = useState('');
            const [toast, setToast] = useState({ message: '', type: '' });
            const [appliedCoupon, setAppliedCoupon] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [isSearching, setIsSearching] = useState(false);
            const [searchResults, setSearchResults] = useState([]);

            const { get, post, isLoading, error, setError } = useApi();

            const totalCartItems = cart.reduce((acc, item) => acc + item.qty, 0);
            const totalCartValue = cart.reduce((acc, item) => acc + (item.salePrice || item.price) * item.qty, 0) -
                                 (appliedCoupon?.discountAmount || 0);

            // Fetch products and offers on mount
            useEffect(() => {
                const fetchInitialData = async () => {
                    const productsData = await get({ action: 'getProducts' });
                    setProducts(productsData.map(p => ({
                        ...p,
                        price: parseFloat(p.price),
                        salePrice: parseFloat(p.price) * 0.9, // 10% discount for demo
                        stock: Math.floor(Math.random() * 100) + 20,
                        rating: (Math.random() * 2 + 3).toFixed(1),
                        reviews: Math.floor(Math.random() * 100) + 10
                    })));

                    // Demo offers
                    setOffers([
                        { id: 1, code: 'WELCOME20', title: 'Welcome Offer', type: 'percentage', value: 20,
                          status: 'Active', endDate: '2024-12-31' },
                        { id: 2, code: 'FLAT100', title: 'Flat Discount', type: 'fixed', value: 100,
                          status: 'Active', endDate: '2024-12-31' },
                        { id: 3, code: 'FREESHIP', title: 'Free Shipping', type: 'shipping', value: 0,
                          status: 'Active', endDate: '2024-12-31' }
                    ]);
                };
                fetchInitialData();
            }, [get]);

            // Cart management
            const updateCartStorage = (newCart) => {
                setCart(newCart);
                localStorage.setItem('muruganCart', JSON.stringify(newCart));
            };

            const addToCart = (product) => {
                const existingItem = cart.find(item => item.id === product.id);
                let newCart;

                if (existingItem) {
                    newCart = cart.map(item =>
                        item.id === product.id ? { ...item, qty: item.qty + 1 } : item
                    );
                } else {
                    newCart = [...cart, { ...product, qty: 1 }];
                }
                updateCartStorage(newCart);
                showToast(`Added "${product.name}" to cart!`, 'success');
            };

            const changeQty = (id, delta) => {
                const existingItem = cart.find(item => item.id === id);
                if (!existingItem) return;

                const newQty = existingItem.qty + delta;
                if (newQty <= 0) {
                    const newCart = cart.filter(item => item.id !== id);
                    updateCartStorage(newCart);
                    showToast(`Removed "${existingItem.name}" from cart`, 'info');
                } else {
                    const newCart = cart.map(item =>
                        item.id === id ? { ...item, qty: newQty } : item
                    );
                    updateCartStorage(newCart);
                }
            };

            const applyCoupon = async (code, subtotal) => {
                const res = await post({ action: 'applyCoupon', couponCode: code, totalAmount: subtotal });
                if (res.status === 'success') {
                    setAppliedCoupon({
                        code,
                        discountAmount: res.discountAmount,
                        newTotal: res.newTotal
                    });
                    showToast(res.message, 'success');
                } else {
                    showToast(res.message, 'error');
                }
            };

            const removeCoupon = () => {
                setAppliedCoupon(null);
                showToast('Coupon removed', 'info');
            };

            // User management
            const logout = () => {
                setUser(null);
                localStorage.removeItem('muruganUser');
                localStorage.removeItem('muruganToken');
                showToast('Logged out successfully', 'success');
                setView('home');
            };

            // Toast notifications
            const showToast = (message, type, duration = 3000) => {
                setToast({ message, type });
                setTimeout(() => setToast({ message: '', type: '' }), duration);
            };

            // Search functionality
            const handleSearch = (term) => {
                setSearchTerm(term);
                if (term.length > 2) {
                    setIsSearching(true);
                    const results = products.filter(p =>
                        p.name.toLowerCase().includes(term.toLowerCase()) ||
                        p.category.toLowerCase().includes(term.toLowerCase()) ||
                        p.description.toLowerCase().includes(term.toLowerCase())
                    );
                    setSearchResults(results);
                    setIsSearching(false);
                } else {
                    setSearchResults([]);
                }
            };

            // Header Component
            const Header = () => (
                <header className="bg-amazon-dark sticky top-0 z-50">
                    <div className="max-w-screen-2xl mx-auto px-4 py-2">
                        <div className="flex items-center justify-between">
                            {/* Logo */}
                            <button
                                onClick={() => setView('home')}
                                className="flex items-center space-x-2"
                            >
                                <div className="w-10 h-10 bg-amazon-yellow rounded-lg flex items-center justify-center">
                                    <i className="fa-solid fa-store text-amazon-dark text-xl"></i>
                                </div>
                                <div className="hidden md:block">
                                    <h1 className="text-xl font-bold text-white">Murugan Store</h1>
                                    <p className="text-xs text-gray-300">Super Mart</p>
                                </div>
                            </button>

                            {/* Search Bar */}
                            <div className="flex-grow max-w-2xl mx-4">
                                <div className="relative">
                                    <input
                                        type="text"
                                        value={searchTerm}
                                        onChange={(e) => handleSearch(e.target.value)}
                                        placeholder="Search for products, categories, brands..."
                                        className="w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amazon-yellow"
                                    />
                                    <button className="absolute right-2 top-1/2 transform -translate-y-1/2">
                                        <i className="fa-solid fa-search text-gray-400"></i>
                                    </button>

                                    {/* Search Results Dropdown */}
                                    {searchTerm.length > 2 && (
                                        <div className="absolute top-full left-0 right-0 bg-white rounded-lg shadow-2xl mt-1 max-h-96 overflow-y-auto z-50">
                                            {isSearching ? (
                                                <div className="p-4 text-center">
                                                    <i className="fa-solid fa-spinner fa-spin text-amazon-yellow"></i>
                                                    <span className="ml-2">Searching...</span>
                                                </div>
                                            ) : searchResults.length > 0 ? (
                                                <>
                                                    <div className="p-3 border-b">
                                                        <p className="text-sm text-gray-500">
                                                            Found {searchResults.length} results
                                                        </p>
                                                    </div>
                                                    {searchResults.map(product => (
                                                        <button
                                                            key={product.id}
                                                            onClick={() => {
                                                                setSelectedProduct(product);
                                                                setSearchTerm('');
                                                                setSearchResults([]);
                                                            }}
                                                            className="w-full text-left p-3 hover:bg-gray-50 border-b flex items-center"
                                                        >
                                                            <img
                                                                src={product.image}
                                                                alt={product.name}
                                                                className="w-10 h-10 object-contain mr-3"
                                                            />
                                                            <div className="flex-grow">
                                                                <p className="font-medium">{product.name}</p>
                                                                <p className="text-sm text-gray-500">{product.category}</p>
                                                            </div>
                                                            <p className="font-bold text-red-600">₹{product.salePrice || product.price}</p>
                                                        </button>
                                                    ))}
                                                </>
                                            ) : (
                                                <div className="p-4 text-center text-gray-500">
                                                    <i className="fa-solid fa-search mb-2"></i>
                                                    <p>No products found for "{searchTerm}"</p>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* User Actions */}
                            <div className="flex items-center space-x-4">
                                {user ? (
                                    <>
                                        <button
                                            onClick={() => setView('account')}
                                            className="hidden md:flex items-center space-x-2 text-white hover:text-amazon-yellow"
                                        >
                                            <div className="w-8 h-8 bg-amazon-yellow rounded-full flex items-center justify-center">
                                                <i className="fa-solid fa-user text-amazon-dark"></i>
                                            </div>
                                            <div className="text-left">
                                                <p className="text-xs">Hello,</p>
                                                <p className="text-sm font-bold">{user.name.split(' ')[0]}</p>
                                            </div>
                                        </button>
                                        <button
                                            onClick={() => setView('cart')}
                                            className="relative text-white hover:text-amazon-yellow"
                                        >
                                            <i className="fa-solid fa-shopping-cart text-xl"></i>
                                            {totalCartItems > 0 && (
                                                <span className="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">
                                                    {totalCartItems}
                                                </span>
                                            )}
                                        </button>
                                        {user.role === 'admin' && (
                                            <button
                                                onClick={() => setView('admin')}
                                                className="hidden md:block px-3 py-1 bg-amazon-yellow text-amazon-dark rounded-lg text-sm font-bold hover:bg-amazon-orange"
                                            >
                                                Admin
                                            </button>
                                        )}
                                        <button
                                            onClick={logout}
                                            className="hidden md:block px-3 py-1 border border-white text-white rounded-lg text-sm hover:bg-white hover:text-amazon-dark"
                                        >
                                            Logout
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <button
                                            onClick={() => setView('login')}
                                            className="px-4 py-2 bg-amazon-yellow text-amazon-dark rounded-lg font-bold hover:bg-amazon-orange"
                                        >
                                            Sign In
                                        </button>
                                        <button
                                            onClick={() => setView('register')}
                                            className="hidden md:block px-4 py-2 border border-white text-white rounded-lg hover:bg-white hover:text-amazon-dark"
                                        >
                                            Register
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>

                        {/* Quick Categories */}
                        <div className="hidden md:flex items-center justify-center space-x-6 mt-2">
                            {['All', 'Groceries', 'Electronics', 'Fashion', 'Home', 'Beauty', 'Offers'].map(cat => (
                                <button
                                    key={cat}
                                    onClick={() => {
                                        if (cat === 'Offers') setView('offers');
                                        else showToast(`Browsing ${cat}`, 'info');
                                    }}
                                    className="text-white text-sm hover:text-amazon-yellow transition"
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>
                    </div>
                </header>
            );

            // Determine if mobile nav should be shown
            const shouldRenderMobileNav = !['login', 'register', 'checkout', 'address', 'admin'].includes(view) && !selectedOrder;

            return (
                <div className="min-h-screen flex flex-col bg-gray-50">
                    <Header />

                    <main className="flex-grow">
                        {/* Home Page */}
                        {view === 'home' && (
                            <div className="max-w-screen-2xl mx-auto p-4">
                                <HeroBanner offers={offers} />
                                <CategoriesSection
                                    categories={[]}
                                    onCategoryClick={(cat) => showToast(`Browsing ${cat}`, 'info')}
                                />
                                <OffersSection offers={offers} />
                                <FeaturedProducts
                                    products={products}
                                    onAddToCart={addToCart}
                                    onQuickView={setSelectedProduct}
                                />
                            </div>
                        )}

                        {/* Cart Page */}
                        {view === 'cart' && (
                            <CartView
                                cart={cart}
                                changeQty={changeQty}
                                total={totalCartValue}
                                setView={setView}
                                user={user}
                                applyCoupon={applyCoupon}
                                appliedCoupon={appliedCoupon}
                                removeCoupon={removeCoupon}
                            />
                        )}

                        {/* Address Page */}
                        {view === 'address' && (
                            <AddressView
                                user={user}
                                setView={setView}
                                address={address}
                                setAddress={setAddress}
                                city={city}
                                setCity={setCity}
                                pincode={pincode}
                                setPincode={setPincode}
                                showToast={showToast}
                            />
                        )}

                        {/* Checkout Page */}
                        {view === 'checkout' && (
                            <CheckoutView
                                user={user}
                                cart={cart}
                                total={totalCartValue}
                                setView={setView}
                                post={post}
                                updateCartStorage={updateCartStorage}
                                isLoading={isLoading}
                                setError={setError}
                                address={address}
                                city={city}
                                pincode={pincode}
                                showToast={showToast}
                                appliedCoupon={appliedCoupon}
                            />
                        )}

                        {/* Authentication Pages */}
                        {view === 'login' && (
                            <AuthView
                                mode="login"
                                post={post}
                                setView={setView}
                                setUser={setUser}
                                setError={setError}
                                showToast={showToast}
                            />
                        )}

                        {view === 'register' && (
                            <AuthView
                                mode="register"
                                post={post}
                                setView={setView}
                                setUser={setUser}
                                setError={setError}
                                showToast={showToast}
                            />
                        )}

                        {/* Order History */}
                        {view === 'history' && (
                            <OrderHistory
                                user={user}
                                get={get}
                                setView={setView}
                                setSelectedOrder={setSelectedOrder}
                            />
                        )}

                        {/* Account Page */}
                        {view === 'account' && (
                            <AccountProfileView
                                user={user}
                                setView={setView}
                                logout={logout}
                                showToast={showToast}
                                get={get}
                                post={post}
                            />
                        )}

                        {/* Admin Panel */}
                        {view === 'admin' && user?.role === 'admin' && (
                            <AdminPanel
                                showToast={showToast}
                                setSelectedOrder={setSelectedOrder}
                                user={user}
                            />
                        )}

                        {/* Bill/Invoice View */}
                        {selectedOrder && (
                            <BillGenerator
                                order={selectedOrder}
                                onBack={() => setSelectedOrder(null)}
                            />
                        )}

                        {/* Quick View Modal */}
                        <ProductQuickView
                            product={selectedProduct}
                            onClose={() => setSelectedProduct(null)}
                            onAddToCart={addToCart}
                        />
                    </main>

                    {/* Mobile Navigation */}
                    {shouldRenderMobileNav && (
                        <MobileNavBar
                            view={view}
                            setView={setView}
                            totalCartItems={totalCartItems}
                            user={user}
                        />
                    )}

                    {/* Toast Notifications */}
                    <ToastNotification
                        message={toast.message}
                        type={toast.type}
                        onClose={() => setToast({ message: '', type: '' })}
                    />

                    {/* Footer */}
                    <footer className="bg-amazon-light text-white mt-8">
                        <div className="max-w-screen-2xl mx-auto px-4 py-8">
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                                <div>
                                    <h3 className="text-xl font-bold mb-4">Murugan Super Store</h3>
                                    <p className="text-gray-300">
                                        Your one-stop destination for all daily needs. Quality products at affordable prices.
                                    </p>
                                </div>
                                <div>
                                    <h4 className="font-bold mb-4">Quick Links</h4>
                                    <ul className="space-y-2">
                                        <li><a href="#" className="text-gray-300 hover:text-white">About Us</a></li>
                                        <li><a href="#" className="text-gray-300 hover:text-white">Contact Us</a></li>
                                        <li><a href="#" className="text-gray-300 hover:text-white">Privacy Policy</a></li>
                                        <li><a href="#" className="text-gray-300 hover:text-white">Terms & Conditions</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 className="font-bold mb-4">Customer Service</h4>
                                    <ul className="space-y-2">
                                        <li><a href="#" className="text-gray-300 hover:text-white">Help Center</a></li>
                                        <li><a href="#" className="text-gray-300 hover:text-white">Track Your Order</a></li>
                                        <li><a href="#" className="text-gray-300 hover:text-white">Returns & Refunds</a></li>
                                        <li><a href="#" className="text-gray-300 hover:text-white">FAQ</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 className="font-bold mb-4">Contact Us</h4>
                                    <div className="space-y-2">
                                        <p className="flex items-center text-gray-300">
                                            <i className="fa-solid fa-phone mr-2"></i> +91 9876543210
                                        </p>
                                        <p className="flex items-center text-gray-300">
                                            <i className="fa-solid fa-envelope mr-2"></i> support@muruganstore.com
                                        </p>
                                        <p className="flex items-center text-gray-300">
                                            <i className="fa-solid fa-location-dot mr-2"></i> Chennai, Tamil Nadu
                                        </p>
                                    </div>
                                    <div className="flex space-x-4 mt-4">
                                        <a href="#" className="text-gray-300 hover:text-white">
                                            <i className="fa-brands fa-facebook text-xl"></i>
                                        </a>
                                        <a href="#" className="text-gray-300 hover:text-white">
                                            <i className="fa-brands fa-instagram text-xl"></i>
                                        </a>
                                        <a href="#" className="text-gray-300 hover:text-white">
                                            <i className="fa-brands fa-twitter text-xl"></i>
                                        </a>
                                        <a href="#" className="text-gray-300 hover:text-white">
                                            <i className="fa-brands fa-whatsapp text-xl"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div className="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                                <p>&copy; 2024 Murugan Super Store. All rights reserved.</p>
                                <p className="text-sm mt-2">Powered by Google Sheets API</p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>